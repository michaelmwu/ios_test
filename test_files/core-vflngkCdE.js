/*
 A JavaScript implementation of the SHA family of hashes, as defined in FIPS
 PUB 180-2 as well as the corresponding HMAC implementation as defined in
 FIPS PUB 198a

 Copyright Brian Turek 2008-2012
 Distributed under the BSD License
 See http://caligatio.github.com/jsSHA/ for more information

 Several functions taken from Paul Johnson
*/

define("modules/core/exception",[],function(){var e;return e=function(){function e(){}return e.strip_comments=function(e){return e.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"")},e.fn_body=function(t){var n;return n=e.strip_comments(t.toString()),n=n.replace(/[\s]+/g," "),n[0]==="("&&(n=n.substr(1)),n[n.length-1]===")"&&(n=n.substr(0,n.length-1)),n=n.replace("function (","function("),n},e.stackTrace=function(){var t,n,r,i,s;i=[],s={},t=arguments.callee.caller;while(t){if(t.__tb_ajax_info__){i.unshift("Ajax.DBRequest: "+t.__tb_ajax_info__);break}if(t.__tb__){i=t.__tb__.concat(i);break}r=e.fn_body(t);if(r in s)break;s[r]=!0,i.unshift(r);try{t=t.caller}catch(o){n=o,t=null;break}}return i},e.__callbacks=[],e.registerOnFailedAssert=function(e){return this.__callbacks.push(e)},e.reportException=function(t,n,r,i,s,o){var u,a,f;window.active_user_loaded?window.an_error_happened_after_loading=!0:window.an_error_happened_before_loading=!0;if(window.reported_exception==null||s){f="";if(!i)try{a=e.stackTrace(),a.pop(),a.pop(),i=a.join("\\n")}catch(l){}o||(o=[]),u={e:t,f:n||window.location.href,l:r||"",loc:window.location.href,ref:typeof Constants!="undefined"&&Constants!==null?Constants.referrer:void 0,tb:i,trace:typeof Trace!="undefined"&&Trace!==null?Trace.get():void 0,tags:JSON.stringify(o)},typeof jQuery!="undefined"&&jQuery!==null&&typeof jQuery.ajax=="function"&&jQuery.ajax({url:"/jse",type:"POST",data:u}),window.reported_exception=t;if((typeof Constants!="undefined"&&Constants!==null?!Constants.IS_PROD:!void 0)&&window.sessionStorage)return u.source="exception.coffee",window.sessionStorage.setItem("reported_exception",JSON.stringify(u))}},e.alert=function(t){return typeof jQuery!="undefined"&&jQuery!==null&&typeof jQuery.ajax=="function"&&jQuery.ajax({url:"/tormod",type:"POST",data:{tor:""+t,mod:window.location.href,ssk:e.stackTrace().join("\n\n"),oog:document.documentElement.innerHTML}}),window.alertd(t)},e.alertd=function(e){return window.alertd(e)},e.assert=function(t,n,r,i,s,o){var u,a,f,l,c;r==null&&(r=!0),i==null&&(i=[]),s==null&&(s=!0),o==null&&(o=typeof Constants!="undefined"&&Constants!==null?!Constants.IS_PROD:!void 0);if(!t){n="Assertion Error: "+n,o&&typeof console!="undefined"&&console!==null&&typeof console.trace=="function"&&console.trace(),(typeof Constants!="undefined"&&Constants!==null?!Constants.IS_PROD:!void 0)&&alertd(n),a=e.stackTrace(),a.pop(),e.reportException(n,window.location.href,"",a.join("\n"),r,i),c=e.__callbacks;for(f=0,l=c.length;f<l;f++)u=c[f],u(n,a);if(s)throw n}},e}(),window.onerror=function(t,n,r){return e.reportException(t,n,r)},window.alertd=window.alert,window.alert=e.alert,window.assert=e.assert,window.reportException=e.reportException,window.stackTrace=e.stackTrace,e}),define("modules/core/uri",["modules/core/exception"],function(e){var t,n,r;return r=e.assert,n=function(){function e(n,r){var i,s,o,u;if(!(this instanceof e))return new e(n,r);this._query=new t,o={};if(typeof n=="string"||n instanceof e){if(typeof Constants!="undefined"&&Constants!==null?!Constants.IS_PROD:!void 0)throw new Error("URI/uri string passed into URI constructor.  Use URI.parse instead.");o=e.parse(n).toObject()}else typeof n=="object"&&(o=n);if(r&&(typeof Constants!="undefined"&&Constants!==null?!Constants.IS_PROD:!void 0))throw new Error("Multiple arguments passed into URI constructor.");s=r||{};for(i in s)u=s[i],o[i]=u;this.initFromObject(o)}return e.prototype.initFromObject=function(e){var t,n,r;return r=e!=null?e:{},n=r.scheme,this.authority=r.authority,this.path=r.path,t=r.query,this.fragment=r.fragment,this.setScheme(n),this.setQuery(t)},e.parse=function(n){var i,s,o,u,a,f,l,c;return r(n!=null,"must pass in a valid url-encoded string"),i=String(n).match(e.REGEXP)||[],c=i[0],l=i[1],o=i[2],a=i[3],f=i[4],u=i[5],s=new e,s.setScheme(l),s.setAuthority(e.decode(o)),s.setPath(e.decode(a)),s.setQuery(t.parse_string(f)),s.setFragment(e.decode(u)),s},e.prototype.getScheme=function(){return this.scheme||""},e.prototype.setScheme=function(t){return r(!t||t.match(e.SCHEME_REGEXP,"Invalid scheme")),this.scheme=t,this},e.prototype.getAuthority=function(){return this.authority||""},e.prototype.setAuthority=function(e){return this.authority=e,this},e.prototype.getPath=function(){return this.path||""},e.prototype.setPath=function(e){return this.path=e,this},e.prototype.getFragment=function(){return this.fragment||""},e.prototype.setFragment=function(e){return this.fragment=e,this},e.prototype.getQuery=function(){return this._query.dict},e.prototype.setQuery=function(e){return e==null&&(e={}),this._query=new t(e),this},e.prototype.updateQuery=function(e,t){return t==null&&(t=null),this._query.add(e,t),this},e.prototype.clone=function(){return e(this.toObject())},e.prototype.toObject=function(){return{scheme:this.getScheme(),authority:this.getAuthority(),path:this.getPath(),query:this.getQuery(),fragment:this.getFragment()}},e.prototype.toString=function(){var t,n;return n="",this.scheme&&(n+=this.scheme+":"),this.authority&&(n+="//"+e.encode(this.authority,":@[]")),this.path&&(r(!this.authority||!this.path.length||this.path[0]==="/",'Path must start with a "/" if URI is not relative'),n+=e.encode(this.path,"/")),t=this._query.toString(),t&&(n+="?"+t),this.fragment&&(n+="#"+e.encode(this.fragment,":@[]/&=+?#!")),n},e.REGEXP=/^(?:([^:/\\?#]+):)?(?:[/\\]{2}([^/\\?#]*))?([^?#]*)(?:\?([^#]*))?(?:[#](.*))?$/,e.SCHEME_REGEXP=/^[a-zA-Z][a-zA-Z0-9+.\-]*$/,e.decode=function(e){return e?decodeURIComponent(e):""},e.encode=function(e,t){var n,r,i,s;t==null&&(t="");if(!e)return"";e=encodeURIComponent(e),t+="~";for(i=0,s=t.length;i<s;i++)r=t[i],n=encodeURIComponent(r),e=e.replace(new RegExp(n,"g"),r);return e},e}(),t=function(){function e(e){this.dict={},this.add(e)}return e.parse_string=function(t){var n,r,i,s,o,u,a,f;if(!t)return null;i={},s=t.split("&");for(a=0,f=s.length;a<f;a++)r=s[a],r!==""&&(o=r.split("="),n=e.decode(o[0]),u=e.decode(o.slice(1).join("=")),n in i?(Array.isArray(i[n])||(i[n]=[i[n]]),i[n].push(u)):i[n]=u);return i},e.prototype.add=function(e,t){var n,r,i,s;t==null&&(t=null);if(typeof e=="string")t!=null&&(Array.isArray(t)?this.dict[e]=function(){var e,r,i;i=[];for(e=0,r=t.length;e<r;e++)n=t[e],i.push(String(n));return i}():this.dict[e]=String(t));else{i=e||{};for(r in i)s=i[r],s!=null&&(Array.isArray(s)?this.dict[r]=function(){var e,t,r;r=[];for(e=0,t=s.length;e<t;e++)n=s[e],r.push(String(n));return r}():this.dict[r]=String(s))}return this},e.prototype.replace=function(e){return this.dict=e||{},this},e.prototype.toString=function(){var t,n,r,i;n=[],i=this.dict;for(t in i)r=i[t],Array.isArray(r)?r.forEach(function(r){return n.push(e.encode(t)+"="+e.encode(r))}):n.push(e.encode(t)+"="+e.encode(r));return n.length?n.join("&"):""},e.decode=function(e){return e===null?"":n.decode(e.replace(/\+/g,"%20"))},e.encode=function(e){return e===null?"":n.encode(e).replace(/%20/g,"+")},e}(),window.URI=n,n});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/core/browser",["modules/core/exception","modules/core/uri"],function(e,t){var n,r,i,s,o;return r=e.assert,o=function(e){var t;return e=e.toLowerCase(),t=/(ipad)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||/(trident).*? rv:([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],{browser:t[1]||"",version:t[2]||"0"}},i=o(navigator.userAgent),i.browser==="trident"&&(i.browser="msie"),s=typeof Constants!="undefined"&&Constants!==null?[Constants.WEBSERVER,Constants.BLOCK_CLUSTER]:[],n={version:i.version,msie_version_at_most:function(e){return n.msie&&parseInt(n.version,10)<=e},get_uri:function(e){return e==null&&(e=window),t.parse(this.get_href(e))},get_href:function(e){return e==null&&(e=window),e.location.href},_parse_target:function(e,n){var i,o,u,a,f,l;return n==null&&(n=window),u=n.document.createElement("a"),u.href=e,u.protocol===":"?f=n.location.protocol:f=u.protocol||n.location.protocol,i=u.hostname||n.location.hostname,a=u.pathname.indexOf("/")===0?u.pathname:"/"+u.pathname,e=f+"//"+i+a+u.search+u.hash,o=t.parse(String(e)),r((l=o.authority,__indexOf.call(s,l)>=0)&&o.scheme==="https","Target URI must be secure and in domain whitelist"),o},redirect:function(e,t){var n;return t==null&&(t=window),n=this._parse_target(e,t),t.location.href=n.toString()},replace_location:function(e){var t;return t=this._parse_target(e),window.location.replace(t.toString())},reload:function(){return window.location.reload()},unsafeRedirect:function(e){return window.location.href=e}},n[i.browser]=!0,n.ipad?(n.webkit=!0,n.safari=!0):n.chrome?n.webkit=!0:n.webkit&&(n.safari=!0),n}),define("modules/core/instantiate",["modules/core/exception"],function(e){var t,n,r;return t=e.assert,n=function(e,n){var r;return t(e),r=function(){return e.apply(this,n)},r.prototype=e.prototype,new r},r={construct:n},r}),define("modules/core/controller_registry",["jquery","modules/core/exception","modules/core/instantiate"],function(e,t,n){var r,i,s,o;return i=t.assert,o=n.construct,s=function(t,n,r){var i,s,u,a;i=[t].concat(r);for(u=0,a=t.length;u<a;u++)s=t[u],e(s).data("jscontroller",o(n,i));return t},r=function(){function t(){}return t.controllers={},t.register_controller=function(e,t,n){return this.controllers[e]={constructor:t,args:n},this.find_and_bind_controller(e)},t.bind_controller=function(e){var t,n;return t=e.data("js-component-id"),i(this.controllers[t],"No controller for "+t),n=this.controllers[t],s(e,n.constructor,n.args)},t.find_and_bind_controller=function(t){var n,r;return i(this.controllers[t],"No controller for "+t),r=this.controllers[t],n=e("[data-js-component-id='"+t+"']"),s(n,r.constructor,r.args)},t}(),r}),define("modules/core/cookies",[],function(){var e;return e={create:function(e,t,n){var r,i;return i="",n&&(r=new Date,r.setTime(r.getTime()+n*24*60*60*1e3),i="; expires="+r.toGMTString()),document.cookie=""+e+"="+t+i+"; path=/"},read:function(e){var t,n,r,i,s;n=""+e+"=",s=document.cookie.split(";");for(r=0,i=s.length;r<i;r++){t=s[r];while(t.charAt(0)===" ")t=t.substring(1,t.length);if(t.indexOf(n)===0)return t.substring(n.length,t.length)}return null},"delete":function(e){return this.create(e,"",-1)},are_enabled:function(){return navigator.cookieEnabled!=null?navigator.cookieEnabled:(document.cookie="this_is_a_test_cookie",document.cookie.indexOf("this_is_a_test_cookie")!==-1)}},window.Cookies=e,e}),define("modules/core/dom",["jquery","modules/core/controller_registry","modules/core/exception"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;return r=n.assert,i=function(n){var r,s,o,a;a=n.children();for(s=0,o=a.length;s<o;s++)r=a[s],i(e(r));if(!u(n)&&n.data("js-component-id"))return t.bind_controller(n)},s=function(e){var t;return r(e,"Trying to clone nonexistent element"),t=e.clone(),i(t),t},u=function(e){return e.data("jscontroller")},y=function(e,t){return e.data("jscontroller",t)},c=function(e){return e?e.nodeType===1?!0:e.length>=1&&e[0].nodeType===1?!0:!1:!1},l=function(){var e,t,n,r,i;return((e=(t=document.activeElement)!=null?t.tagName:void 0)==="INPUT"||e==="TEXTAREA"||e==="SELECT")&&(n=(r=document.activeElement)!=null?r.type:void 0)!=="submit"&&n!=="button"||((i=document.activeElement)!=null?i.getAttribute("contentEditable"):void 0)},w=function(t){var n,r,i;return n=e(t),i=n.offset(),r=e(window),{left:i.left-r.scrollLeft(),top:i.top-r.scrollTop()}},S=null,T=null,b=function(){return S||(S={height:e(window).height(),width:e(window).width()}),T||(T=e(window).on("resize",function(){return S=null})),S},a=function(){return Math.max(e(document).height(),e(window).height(),document.documentElement.clientHeight)},N=null,E=null,v=function(){var t,n,r;return N||(N=e(window).scroll(function(){return E=null})),x()?E||(r=e(window).scrollTop(),n=e(window).scrollLeft(),E={0:n,1:r,left:n,top:r}):(t=e(document.documentElement),r=-1*parseInt(t.css("top"),10),n=-1*parseInt(t.css("left"),10),E={0:n,1:r,left:n,top:r}),E},h=function(){return E=null},x=function(){return!e(document.documentElement).hasClass("no-scroll")},d=0,p=function(){var t,n,r,i;d++,t=e(document.documentElement);if(!t.hasClass("no-scroll"))return i=v(),r=-1*i.top+"px",n=-1*i.left+"px",t.css({top:r,left:n}),t.addClass("no-scroll")},g=function(){var t,n,r;d>0&&d--,t=e(document.documentElement);if(d===0&&t.hasClass("no-scroll"))return r=-1*parseInt(t.css("top"),10),n=-1*parseInt(t.css("left"),10),t.css({top:"",left:""}),t.removeClass("no-scroll"),m(n,r+1),m(n,r-1),m(n,r)},m=function(e,t){return e=Math.max(e,0),t=Math.max(t,0),t>v().top&&(t=Math.min(t,a()-f.viewport_dimensions().height)),window.scrollTo(e,t),E={0:e,1:t,left:e,top:t}},o=function(t,n,r){var i,s,o,u,a,f,l,c;return s=e(n),o=e(t),f={setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},r=e.extend({},f,r),c=w(s),l={top:0,left:0},i=null,o.css("position")==="absolute"&&(i=o.offsetParent(),l=w(i)),i&&i[0]===document.body&&(l.left-=document.body.offsetLeft,l.top-=document.body.offsetTop),r.setLeft&&(u=c.left-l.left+r.offsetLeft+"px",o.css("left",u)),r.setTop&&(a=c.top-l.top+r.offsetTop+"px",o.css("top",a)),r.setWidth&&o.width(s[0].offsetWidth),r.setHeight&&o.height(s[0].offsetHeight),o},w=function(t){var n,r,i;return n=e(t),i=n.offset(),r=e(window),{left:i.left-r.scrollLeft(),top:i.top-r.scrollTop()}},f={bind_controllers:i,clone:s,clone_position:o,controller:u,focus_in_input:l,scroll_clear_cache:h,scroll_lock_document:p,scroll_offsets:v,scroll_to:m,scroll_unlock_document:g,set_controller:y,is_element:c,viewport_offset:w,viewport_dimensions:b},f}),define("modules/core/html",[],function(){var e;return e=function(){function e(e){this._str_DONT_TOUCH=e}return e.prototype.toHTML=function(){return this._str_DONT_TOUCH},e.prototype.toString=function(){return"[object HTML]"},e}(),function(){var t,n,r,i;return e.tmpl=function(e,t){var n;return/[^\w:.-]/.test(e)||(e=document.getElementById(e).innerHTML),n=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.*?)%>/g,"',HTML._raw_escape($1),'").split("<%").join("');").split("%>").join("p.push('")+"');}return new HTML(jQuery.trim(p.join('')));"),t?n(t):n},t=/[^\w@\.\ \-\(\)\,\$~%#\[\]\{\}\!\^]/g,r=function(e){return"&#"+e.charCodeAt(0)+";"},n=function(e){return(""+e).replace(t,r)},e.escape=function(t){return t instanceof e?t:new e(n(t))},e._raw_escape=i=function(t){return t instanceof e?t.toHTML():typeof t=="number"?t:n(t)}}(),window.HTML=e,e});var __slice=[].slice;define("modules/core/kwargs",[],function(){var e;return e=function(){var e,t,n,r,i,s,o,u,a,f,l;s=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],i={},s=function(){var e,t,n;n=[];for(e=0,t=s.length;e<t;e++)o=s[e],n.push(typeof o=="string"?{name:o,"default":void 0}:{name:o[0],"default":o[1]});return n}(),t=function(){var t,n,r,i,o,u,a,f;if(e==null||typeof e[e.length-1]!="object")return!1;r={};for(t=o=u=e.length-1,a=s.length-1;o<=a;t=o+=1)r[s[t].name]=!0;f=e[e.length-1];for(n in f){i=f[n];if(!(n in r))return!1}return!0};if(t()){f=e[e.length-1];for(r in f)u=f[r],i[r]=u;e.pop()}for(n=a=0,l=s.length-1;a<=l;n=a+=1)n<e.length?i[s[n].name]=e[n]:s[n].name in i||(i[s[n].name]=s[n]["default"]);return i},e}),function(){function e(e){throw e}function t(e,t){var n=[],r=(1<<t)-1,i=e.length*t,s;for(s=0;s<i;s+=t)n[s>>>5]|=(e.charCodeAt(s/t)&r)<<32-t-s%32;return{value:n,binLen:i}}function n(t){var n=[],r=t.length,i,s;0!==r%2&&e("String of HEX type must be in byte increments");for(i=0;i<r;i+=2)s=parseInt(t.substr(i,2),16),isNaN(s)&&e("String of HEX type contains invalid characters"),n[i>>>3]|=s<<24-4*(i%8);return{value:n,binLen:4*r}}function r(t){var n=[],r=0,i,s,o,u,a;-1===t.search(/^[a-zA-Z0-9=+\/]+$/)&&e("Invalid character in base-64 string"),i=t.indexOf("="),t=t.replace(/\=/g,""),-1!==i&&i<t.length&&e("Invalid '=' found in base-64 string");for(s=0;s<t.length;s+=4){a=t.substr(s,4);for(o=u=0;o<a.length;o+=1)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[o]),u|=i<<18-6*o;for(o=0;o<a.length-1;o+=1)n[r>>2]|=(u>>>16-8*o&255)<<24-8*(r%4),r+=1}return{value:n,binLen:8*r}}function i(e,t){var n="",r=4*e.length,i,s;for(i=0;i<r;i+=1)s=e[i>>>2]>>>8*(3-i%4),n+="0123456789abcdef".charAt(s>>>4&15)+"0123456789abcdef".charAt(s&15);return t.outputUpper?n.toUpperCase():n}function s(e,t){var n="",r=4*e.length,i,s,o;for(i=0;i<r;i+=3){o=(e[i>>>2]>>>8*(3-i%4)&255)<<16|(e[i+1>>>2]>>>8*(3-(i+1)%4)&255)<<8|e[i+2>>>2]>>>8*(3-(i+2)%4)&255;for(s=0;4>s;s+=1)n=8*i+6*s<=32*e.length?n+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>>6*(3-s)&63):n+t.b64Pad}return n}function o(t){var n={outputUpper:!1,b64Pad:"="};try{t.hasOwnProperty("outputUpper")&&(n.outputUpper=t.outputUpper),t.hasOwnProperty("b64Pad")&&(n.b64Pad=t.b64Pad)}catch(r){}return"boolean"!=typeof n.outputUpper&&e("Invalid outputUpper formatting option"),"string"!=typeof n.b64Pad&&e("Invalid b64Pad formatting option"),n}function u(e,t){var n=(e&65535)+(t&65535);return((e>>>16)+(t>>>16)+(n>>>16)&65535)<<16|n&65535}function a(e,t,n,r,i){var s=(e&65535)+(t&65535)+(n&65535)+(r&65535)+(i&65535);return((e>>>16)+(t>>>16)+(n>>>16)+(r>>>16)+(i>>>16)+(s>>>16)&65535)<<16|s&65535}function f(e,t){var n=[],r,i,s,o,f,l,c,h,p,d=[1732584193,4023233417,2562383102,271733878,3285377520],v=[1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782];e[t>>>5]|=128<<24-t%32,e[(t+65>>>9<<4)+15]=t,p=e.length;for(c=0;c<p;c+=16){r=d[0],i=d[1],s=d[2],o=d[3],f=d[4];for(h=0;80>h;h+=1)n[h]=16>h?e[h+c]:(n[h-3]^n[h-8]^n[h-14]^n[h-16])<<1|(n[h-3]^n[h-8]^n[h-14]^n[h-16])>>>31,l=20>h?a(r<<5|r>>>27,i&s^~i&o,f,v[h],n[h]):40>h?a(r<<5|r>>>27,i^s^o,f,v[h],n[h]):60>h?a(r<<5|r>>>27,i&s^i&o^s&o,f,v[h],n[h]):a(r<<5|r>>>27,i^s^o,f,v[h],n[h]),f=o,o=s,s=i<<30|i>>>2,i=r,r=l;d[0]=u(r,d[0]),d[1]=u(i,d[1]),d[2]=u(s,d[2]),d[3]=u(o,d[3]),d[4]=u(f,d[4])}return d}window.jsSHA=function(u,a,l){var c=null,h=0,p=[0],d=0,m=null,d="undefined"!=typeof l?l:8;8===d||16===d||e("charSize must be 8 or 16"),"HEX"===a?(0!==u.length%2&&e("srcString of HEX type must be in byte increments"),m=n(u),h=m.binLen,p=m.value):"ASCII"===a||"TEXT"===a?(m=t(u,d),h=m.binLen,p=m.value):"B64"===a?(m=r(u),h=m.binLen,p=m.value):e("inputFormat must be HEX, TEXT, ASCII, or B64"),this.getHash=function(t,n,r){var u=null,a=p.slice(),l="";switch(n){case"HEX":u=i;break;case"B64":u=s;break;default:e("format must be HEX or B64")}return"SHA-1"===t?(null===c&&(c=f(a,h)),l=u(c,o(r))):e("Chosen SHA variant is not supported"),l},this.getHMAC=function(u,a,l,c,m){var b,E,S,T,N,C,L=[],A=[],O=null;switch(c){case"HEX":b=i;break;case"B64":b=s;break;default:e("outputFormat must be HEX or B64")}"SHA-1"===l?(S=64,C=160):e("Chosen SHA variant is not supported"),"HEX"===a?(O=n(u),N=O.binLen,E=O.value):"ASCII"===a||"TEXT"===a?(O=t(u,d),N=O.binLen,E=O.value):"B64"===a?(O=r(u),N=O.binLen,E=O.value):e("inputFormat must be HEX, TEXT, ASCII, or B64"),u=8*S,a=S/4-1,S<N/8?("SHA-1"===l?E=f(E,N):e("Unexpected error in HMAC implementation"),E[a]&=4294967040):S>N/8&&(E[a]&=4294967040);for(S=0;S<=a;S+=1)L[S]=E[S]^909522486,A[S]=E[S]^1549556828;return"SHA-1"===l?T=f(A.concat(f(L.concat(p),u+h)),u+C):e("Unexpected error in HMAC implementation"),b(T,o(m))}}}(),define("external/sha1",function(){});var __slice=[].slice;define("modules/core/i18n",["modules/core/kwargs","modules/core/exception","external/sha1"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;p=t.assert,o="abcdefghijklmnopqrstuvwxyz",u="âḃćḋèḟĝḫíĵǩĺṁńŏṗɋŕśṭůṿẘẋẏẓ",c="ABCDEFGHIJKLMNOPQRSTUVWXYZ",h="ḀḂḈḊḔḞḠḢḬĴḴĻḾŊÕṔɊŔṠṮŨṼẄẌŸƵ",r={};for(d=v=0;v<26;d=++v)r[o.charAt(d)]=u.charAt(d),r[c.charAt(d)]=h.charAt(d);return i=function(){function t(){}return t.messages={},t.emessages={},t.RAND=0,t.NUM_MISSED=0,t.add_i18n_message=function(e,t,n,r){t=t.strip_tags().friendly_format(),n=n.strip_tags(),this.messages[t]=e,this.emessages[t]=n;if(r)return delete this.messages[r],delete this.emessages[r]},t.PLURAL_RULES={SINGULAR_1:function(e){return e===1?0:1},SINGULAR_01:function(e){return e<=1?0:1},SINGULAR_ALL:function(e){return 0},RUSSIA_UKRAINE:function(e){return e%10===1&&e%100!==11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},POLAND:function(e){return e===1?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2}},t.PLURAL_RULES_BY_LOCALE={en:t.PLURAL_RULES.SINGULAR_1,en_GB:t.PLURAL_RULES.SINGULAR_1,da_DK:t.PLURAL_RULES.SINGULAR_1,de:t.PLURAL_RULES.SINGULAR_1,es_ES:t.PLURAL_RULES.SINGULAR_1,es:t.PLURAL_RULES.SINGULAR_1,fr:t.PLURAL_RULES.SINGULAR_01,id:t.PLURAL_RULES.SINGULAR_ALL,it:t.PLURAL_RULES.SINGULAR_1,ja:t.PLURAL_RULES.SINGULAR_ALL,ko:t.PLURAL_RULES.SINGULAR_ALL,ms:t.PLURAL_RULES.SINGULAR_ALL,nb_NO:t.PLURAL_RULES.SINGULAR_1,nl_NL:t.PLURAL_RULES.SINGULAR_1,pl:t.PLURAL_RULES.POLAND,pt_BR:t.PLURAL_RULES.SINGULAR_01,ru:t.PLURAL_RULES.RUSSIA_UKRAINE,sv_SE:t.PLURAL_RULES.SINGULAR_1,th_TH:t.PLURAL_RULES.SINGULAR_ALL,tr:t.PLURAL_RULES.SINGULAR_ALL,uk_UA:t.PLURAL_RULES.RUSSIA_UKRAINE,xx_AC:t.PLURAL_RULES.SINGULAR_1,xx_LS:t.PLURAL_RULES.SINGULAR_1,xx_HA:t.PLURAL_RULES.SINGULAR_1,xx_RL:t.PLURAL_RULES.SINGULAR_1,xx_AE:t.PLURAL_RULES.SINGULAR_1,zh_CN:t.PLURAL_RULES.SINGULAR_ALL,zh_TW:t.PLURAL_RULES.SINGULAR_ALL},t.get_langpack=function(){return window.LANGPACK||(window.LANGPACK={}),window.LANGPACK},t._=function(){var n,r,i,o,u,a,f,l,c;return f=arguments[0],n=2<=arguments.length?__slice.call(arguments,1):[],c=e.apply(null,[[["project","web"],"comment"]].concat(__slice.call(n))),u=c.project,r=c.comment,(typeof Constants!="undefined"&&Constants!==null?Constants.USER_LOCALE:void 0)&&t.locale_is_fake(Constants.USER_LOCALE)?a=t.fake_translate(f,typeof Constants!="undefined"&&Constants!==null?Constants.USER_LOCALE:void 0):(l=s.get_string_key(f,u,r),i=t.get_langpack(),o=i[l]||i[f],o?o instanceof String||typeof o=="string"?a=o:a=o[0]||f:(t.RAND===0&&typeof Constants!="undefined"&&Constants!==null&&Constants.USER_LOCALE!=="en"&&(t.RAND=Math.floor(Math.random()*20+1)),t.RAND===1&&t.NUM_MISSED<4&&(t.NUM_MISSED+=1,typeof jQuery!="undefined"&&jQuery!==null&&jQuery.ajax({url:"/missed_translation_log",type:"POST",data:{message:f,comment:r,project:u}})),a=f)),t.add_i18n_message(f,a,f),a},t.fake_translate=function(e,t){var n,i,s,o,u,a,f;t==="xx_LS"&&(e+="SSSSSSSSSSSSSSSSSSSSSSSSS"),t==="xx_AC"&&!/</.test(e)&&(e=e.toUpperCase()),t==="xx_HA"&&(e="[javascript]"+e);if(t==="xx_RL"&&!/</.test(e)&&!/%/.test(e)){o=97,s=1488,u="",e=e.toLowerCase();for(d=a=0,f=e.length;0<=f?a<f:a>f;d=0<=f?++a:--a)n=e.charCodeAt(d)-o,0<=n&&n<26?u+=String.fromCharCode(s+n):u+=e[d];e=u}return t==="xx_AE"&&!/</.test(e)&&!/%/.test(e)&&(e=function(){var t,n,s,o;o=[];for(d=t=0,n=e.length;0<=n?t<n:t>n;d=0<=n?++t:--t)i=e.charAt(d),o.push((s=r[i])!=null?s:i);return o}().join("")),e},t.locale_is_fake=function(e){return e.indexOf("xx_")!==-1},t.ungettext=function(){var n,r,i,o,u,a,f,l,c,h,d,v,m,g;v=arguments[0],l=arguments[1],f=arguments[2],n=4<=arguments.length?__slice.call(arguments,3):[],g=e.apply(null,[[["project","web"],"comment"]].concat(__slice.call(n))),h=g.project,r=g.comment,p(f!=null,"missing number parameter for ungettext"),u=typeof Constants!="undefined"&&Constants!==null?Constants.USER_LOCALE:void 0;if(u)if(t.locale_is_fake(u))v=t.fake_translate(v,u),l=t.fake_translate(l,u);else{m=s.get_string_key(v,h,r),o=t.get_langpack(),a=o[m]||o[v];if(a){if(a instanceof String||typeof a=="string")return a;c=t.PLURAL_RULES_BY_LOCALE[u](f),c in a&&(d=a[c])}}return i=f===1?v:l,d==null&&(d=i),t.add_i18n_message(v,d,i),d},t.N_=function(){var t,n,r,i,s;return i=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],s=e.apply(null,[[["project","web"],"comment"]].concat(__slice.call(t))),r=s.project,n=s.comment,new a(i,r,n)},t.E_=function(e){return t._(e.msg,e.project,e.comment)},t.render_sentences=function(e){var n,r,i,s,o,u;n=e.length;if(n===1)return e[0];if(n===2)return t._("%s %s",{comment:"Two sentences"}).format(e);if(n===3)return t._("%s %s %s",{comment:"Three sentences"}).format(e);if(n===4)return t._("%s %s %s %s",{comment:"Four sentences"}).format(e);r="",s=0;for(o=0,u=e.length;o<u;o++)i=e[o],r+=i,s!==n-1&&(r+=t._(" ",{comment:"Sentence separator character"})),s+=1;return r},t.i18n_default_project=function(n){return{_:function(){var r,i,s,o;return s=arguments[0],r=2<=arguments.length?__slice.call(arguments,1):[],o=e.apply(null,[[["project",n],"comment"]].concat(__slice.call(r))),n=o.project,i=o.comment,t._(s,n,i)},ungettext:function(){var r,i,s,o,u,a;return u=arguments[0],o=arguments[1],s=arguments[2],r=4<=arguments.length?__slice.call(arguments,3):[],a=e.apply(null,[[["project",n],"comment"]].concat(__slice.call(r))),n=a.project,i=a.comment,t.ungettext(u,o,s,n,i)},N_:function(){var r,i,s,o;return s=arguments[0],r=2<=arguments.length?__slice.call(arguments,1):[],o=e.apply(null,[[["project",n],"comment"]].concat(__slice.call(r))),n=o.project,i=o.comment,t.N_(s,n,i)},E_:t.E_}},t}(),a=function(){function e(e,t,n){this.msg=e,this.project=t,this.comment=n}return e}(),s=function(){function e(){}return e.get_message_context=function(e,t){var n,r,i;return r=void 0,e!=="web"&&(r="project:"+e),t!=null&&(i=new jsSHA(t,"TEXT"),n=i.getHash("SHA-1","HEX"),r!=null?r+=" "+n:r=n),r},e.CONTEXT_DELIMITER="",e.get_string_key=function(t,n,r){var i;return i=e.get_message_context(n,r),i!=null?i+e.CONTEXT_DELIMITER+t:t},e}(),l=function(e){return typeof Array.isArray=="undefined"?Object.prototype.toString.call(e)==="[object Array]":Array.isArray(e)},f=function(){var e,t,n;return e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift(),function(){return t.apply(n,e.concat(Array.prototype.slice.call(arguments)))}},String.prototype.format_sub=function(e){return this.replace(/%(\([a-zA-Z0-9_\-]+\))?(.\d+)?(.)/g,f(e,this))},String.prototype.format=function(){var e,t,n,r,s,o;return arguments.length===0?this.toString():(t=void 0,e=0,arguments.length===1&&arguments[0]instanceof Object?t=arguments[0]:t=Array.prototype.slice.call(arguments,0),s=function(n,r,i,s){var o,u,a,f;r?(r=r.slice(1,-1),p(e<=0,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),e=-1,o=(typeof Constants!="undefined"&&Constants!==null?Constants.USER_LOCALE:void 0)==="xx_AC",p(r in t||o&&r.toLowerCase()in t,"Key '"+r+"' not present during string substitution for string '"+this+"'"),f=t[r],o&&(f=t[r.toLowerCase()])):(l(t)||(t=[t]),p(e>-1,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),p(e<t.length,"Insufficient number of items in format for string '"+this+"'"),f=t[e],e++),p(typeof f!="undefined","value for key '"+(r||"")+"' is undefined"),a=void 0;if(s==="s"||s==="S")a=f.toString();else if(s==="d"||s==="D")a=parseInt(f,10).toString();else if(s==="f"||s==="F")a=Number(f).toString();else{if(s==="%")return"%";p(!1,"Unexpected format character '"+s+"' for string '"+this+"'.")}return i?(i=parseInt(i.slice(1),10),s==="f"||s==="F"?(a.indexOf(!1)&&(a+=".0"),u=a.split("."),u[0]+"."+u[1].slice(0,i)):a.slice(0,i)):a},o=this.format_sub(s),i.messages&&this in i.messages&&(e=0,r=i.emessages[this],n=String.prototype.format_sub.call(r,s),i.add_i18n_message(r,o,n,this)),o)},String.prototype.friendly_format=function(){var e,t,n;return t=function(t,r,i,s){return r?"["+r.slice(1,1).replace("-","_")+"]":s==="s"||s==="S"?"[word"+n++ +"]":"[number"+e++ +"]"},e=1,n=1,this.format_sub(t)},String.prototype.blank_format=function(){var e;return e=function(){return""},this.format_sub(e)},String.prototype.strip_tags=function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},window.ungettext=i.ungettext,window._=i._,window.N_=i.N_,window.E_=i.E_,window.render_sentences=i.render_sentences,i}),define("modules/core/notify",["jquery","modules/core/i18n"],function(e,t){var n,r;return r=t._,n=function(){function t(){}return t.DEFAULT_ERROR=r("There was a problem completing this request."),t.DEFAULT_SUCCESS=r("Your request completed successfully."),t.success=function(e,t){return t==null&&(t=10),e=e||this.DEFAULT_SUCCESS,this._show(e,t,"server-success"),this.current()},t.error=function(e,t){return t==null&&(t=10),e=e||this.DEFAULT_ERROR,this._show(e,t,"server-error"),this.current()},t.warning=function(e,t){return t==null&&(t=10),this._show(e,t,"server-warning"),this.current()},t.info=function(e,t){return t==null&&(t=10),this._show(e,t,"server-info"),this.current()},t.clear=function(){return this._last_timeout&&clearTimeout(this._last_timeout),this._last_animation&&this._last_animation.stop(),this._last_timeout=null,this._last_animation=null,e("#notify").removeClass("server-error server-info server-success server-warning").hide()},t.isShown=function(){return e("#notify").is(":visible")},t.current=function(){return this._last_timeout},t._show=function(e,t,n){return this._buildElement(),this.clear(),this._setMessage(e),this._showElement(n),this._scheduleHide(t),this.current()},t._buildElement=function(){var t;if(e("#notify").length)return;return t='<div id="notify-wrapper"> <span id="notify"> <span id="notify-msg" /> </span> </div>',e("body").append(t)},t._setMessage=function(t){var n;return n=e("#notify-msg"),t.toHTML!=null?n.html(t.toHTML()):t instanceof e?n.html(t):n.text(t)},t._showElement=function(t){var n;return n=e("#notify"),n.addClass(t),this._last_animation=n.fadeIn(500)},t._scheduleHide=function(e){return this._last_timeout=setTimeout(this._hide,e*1e3)},t._hide=function(){var n;return n=e("#notify"),t._last_animation=n.fadeOut(1e3),t._last_timeout=null},t}(),window.Notify=n,n}),define("modules/core/ordered_dictionary",[],function(){var e;return e=function(){function e(e,t){this.list=e,this.dict=t;return}return e.list=[],e.dict={},e.prototype.push=function(e,t){this.list.push(e),this.dict[e]=t},e.prototype.remove=function(e){this.list.removeItem(e),delete this.dict[e]},e.prototype.indexOfKey=function(e){return this.list.indexOf(e)},e.prototype.keyAtIndex=function(e){return this.list[e]},e.prototype.valueFromKey=function(e){return this.dict[e]},e.prototype.valueAtIndex=function(e){return this.dict[this.list[e]]},e.prototype.getValues=function(){var e;return function(){var t,n,r,i;r=this.list,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.dict[e]);return i}.call(this)},e.prototype.length=function(){return this.list.length},e.prototype.insertAtIndex=function(e,t,n){return this.list.splice(e,0,t),this.dict[t]=n},e}(),e}),define("modules/clean/hi_res",["jquery"],function(e){var t;return t=function(){function t(e){var t;if(!this.constructor._show_hi_res())return;t=e.attr("data-hi-res-no-resize"),this.constructor.set_src(e,e.attr("data-hi-res"),t),this.constructor.set_bg(e,e.attr("data-hi-res-background"),t)}return t.set_src=function(e,t,n){if(!this._show_hi_res())return;if(t&&t!==e.attr("src"))return this._replace(e,t,!n,this._replace_img)},t.set_bg=function(e,t,n){if(!this._show_hi_res())return;return this._replace(e,t,!n,this._replace_background)},t._show_hi_res=function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1},t._replace=function(t,n,r,i){var s;if(!n)return;return s=new Image,s.src=n,e(s).on("load",function(){return i(t,n,r,s.width,s.height)})},t._replace_img=function(e,t,n,r,i){e.attr("src",t);if(n)return e.width(r/2),e.height(i/2)},t._replace_background=function(e,t,n,r,i){var s;s="url('%(src)s')".format({src:t}),e.css("backgroundImage",s);if(n)return e.css("backgroundSize",""+r/2+"px "+i/2+"px")},t}(),t}),define("modules/clean/job_progress",["jquery"],function(e){var t,n,r;return r={make:function(t,n){var r,i,s,o,u,a,f;return n==null&&(n=300),f=n.toString()+"px",s=e("<div />",{"class":"outer-progress-bar"}).css({width:f}),r=e("<div />",{"class":"inner-progress-bar",id:"pb_"+t}).css({width:f}),u=e("<div />",{"class":"under-pb progress-bar"}).css({width:f}),o=e("<div />",{"class":"over-pb progress-bar",id:"pb_"+t+"_over"}).css({display:"none"}),a=e("<div />",{"class":"pb-percentage",id:"pb_"+t+"_upct"}).css({width:f}),i=e("<div />",{"class":"pb-percentage",id:"pb_"+t+"_opct"}).css({width:f}),u.append(a),o.append(i),r.append(u),r.append(o),s.append(r),o.data("progress-width",n),s},set:function(t,n){var r,i,s;r=e("#pb_"+t+"_over");if(!r)return;return n=Math.min(n,1),i=r.data("progress-width"),s=String(i*n)+"px",r.show(),r.css({backgroundColor:"#348DD3",overflow:"hidden",width:s})}},t={complete:{},handled:function(e){var n;return e?(n=!!t.complete[e],t.complete[e]=!0,n):!1},peek:function(e){return e?!!t.complete[e]:!1}},n={show:function(t){var n,i,s,o,u,a,f;if(!t)return;typeof DBModalStack!="undefined"&&DBModalStack!==null&&(f=DBModalStack.top())!=null&&f.hide(),n=e("body"),i=e("<div />",{id:"modal-progress-overlay"}),i.hide(),i.appendTo(n),e("#browse-box").length?i.clonePosition(e("#browse-box")):e("#gallery-view-media").length?i.clonePosition(e("#gallery-view-media")):i.css({position:"fixed",width:"100%",height:"100%"});if(!i.width())return;return u=e("<div />",{id:"modal-progress-content"}),o=e("<div />",{id:"modal-progress-container"}),s=e("<div />",{id:"modal-progress-bar",opacity:1,html:r.make("modal-progress",150,"")}),a=e("<div />",{id:"modal-progress-text",text:t}),u.hide(),o.append(s,a),u.append(o),n.append(u),i.fadeTo(250,.7),u.fadeIn(250)},update:function(e){var t;if(e.indexOf("/")>0){t=e.split("/"),e=Number(t[0])/Number(t[1]);if(isNaN(e))return}return r.set("modal-progress",e)},hide:function(){return e("#modal-progress-overlay").fadeOut(250,function(){return e("#modal-progress-overlay").remove()}),e("#modal-progress-content").fadeOut(250,function(){return e("#modal-progress-content").remove()})}},{ModalProgress:n,Job:t}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("modules/clean/storage",[],function(){var e,t,n;return e=function(){function e(){}return e.storage=void 0,e.get=function(e){if(this.storage&&window.JSON)return JSON.parse(this.storage.getItem(e))},e.set=function(e,t){if(!this.storage||!window.JSON)return;return this.storage.setItem(e,JSON.stringify(t))},e}(),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.storage=function(){try{return window.sessionStorage}catch(e){}}(),t}(e),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.storage=function(){try{return window.localStorage}catch(e){}}(),t}(e),{SessionStorage:n,LocalStorage:t}}),define("modules/clean/undo",["jquery","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,n,r){var i,s;return s=n._,i=function(){function t(){}return t.perform_undo=function(){if(this.undo_handler!=null)return this.undo_handler(this.undo_info),this.undo_handler=this.undo_info=null},t.notifyWithUndo=function(n,i,o){var u,a;return i?(this.undo_info=i,this.undo_handler=o,u=e("<span />"),n.toHTML!=null?u.html(n.toHTML()):u.text(n),a=e("<a/>",{href:"#"}).text(s("Undo")),a.on("click",function(){return t.perform_undo(),!1}),u.append("&nbsp;").append(a),this.undo_notification=r.success(u,30)):r.success(n)},t}(),i});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/ajax",["jquery","external/underscore","modules/core/cookies","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/job_progress","modules/clean/storage","modules/clean/undo"],function(e,t,n,r,i,s,o,u,a,f,l){var c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V;return V=s._,_="err:",M="async_task_started:",O="async_task_err:",A="done:",D=function(t,n){var r,i,s,o;return t==null&&(t={}),n==null&&(n=[]),t.type==null&&(t.method!=null?((typeof Constants!="undefined"&&Constants!==null?!Constants.IS_PROD:!void 0)&&console.log('Expected "type" attribute; received "method"'),s=t.method):s="POST",t.type=s),r=new v(t),i=W(r,n),o=e.ajax({url:i.url(),type:t.type,noDropboxDefaults:!0,data:i.data(),dataType:t.dataType||"text",traditional:i.traditional(),xhrFields:i.xhrFields(),success:function(e,t,n){return i.success(e,t,n)},error:function(e,t,n){return i.error(e,t,n)},complete:function(e,t){return i.complete(e,t)}}),i.request(o)},W=function(e,n){var r,i,s,o,u,a,f,l;i=[e],l=t(n.slice(0)).reverse();for(o=0,a=l.length;o<a;o++)r=l[o],i.push(new r);s=null;for(u=0,f=i.length;u<f;u++)r=i[u],s&&(r.next=s),s=r;return s},v=function(){function e(e){e==null&&(e={}),this.options=function(){return e},this.url=function(){return String(e.url||"")},this.data=function(){return e.data||{}},this.traditional=function(){return e.traditional||!1},this.xhrFields=function(){return e.xhrFields||{}},this.success=e.success||this.identity,this.error=e.error||this.identity,this.complete=e.complete||this.identity,this.request=this.identity}return e.prototype.identity=function(e){return e},e}(),y=function(){function e(){}return e.prototype.options=function(){return this.next.options()},e.prototype.url=function(){return this.next.url()},e.prototype.data=function(){return this.next.data()},e.prototype.traditional=function(){return this.next.traditional()},e.prototype.xhrFields=function(){return this.next.xhrFields()},e.prototype.success=function(e,t,n){return this.next.success(e,t,n)},e.prototype.error=function(e,t,n){return this.next.error(e,t,n)},e.prototype.complete=function(e,t){return this.next.complete(e,t)},e.prototype.request=function(e){return this.next.request(e)},e}(),g=function(i){function s(){return s.__super__.constructor.apply(this,arguments)}return __extends(s,i),s.prototype.SUPPORTED_TLDS=["dropbox.com","carousel.com"],s.prototype.data=function(){var t;return r.assert(this._is_db_domain(),"injecting CSRF token into request to non-dropbox domain"),t={is_xhr:!0,t:n.read(Constants.JS_CSRF_COOKIE)||""},e.extend(t,this.next.data())},s.prototype._is_db_domain=function(){var e,n;return e=u.parse(String(this.url())).authority,e?(n=e.split("."),t.reduce(this.SUPPORTED_TLDS,function(e,t){var r,i;return i=t.split("."),r=n.slice(-1*i.length).join("."),e||t===r},!1)):!0},s}(y),B=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.data=function(){var e,t;return e=this.next.data(),t=this.options(),t.subject_user&&!e[Constants.UID_PARAM_NAME]&&(e[Constants.UID_PARAM_NAME]=String(t.subject_user)),e},t}(y),m=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.error=function(e,t,n){var r,i;if(e.status===403){r=f.SessionStorage.get("reload-timestamp"),i=(new Date).getTime();if(!r||i-r>3e4)f.SessionStorage.set("reload-timestamp",i),window.location.reload(!0)}return this.next.error(e,t,n)},t}(y),H=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t;return t=this.next.data(),e.ajaxSettings.restrict!=null&&(t.restrict=e.ajaxSettings.restrict),t},n}(y),P=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t,n;return t=this.next.data(),!Constants.REQUEST_TRACING_ENABLED||this.options().type.toLowerCase()!=="post"?t:(n={parent_request_id:Constants.REQUEST_ID},e.extend(n,t))},n}(y),E=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t,n;return t=this.next.data(),Constants.CPROFILE_ENABLED?(n={parent_request_id:Constants.REQUEST_ID,cProfile:Constants.CPROFILE_PARAMETER},e.extend(n,t)):t},n.prototype.success=function(e,t,n){return this._report_cprofile(e,t,n),this.next.success(e,t,n)},n.prototype._report_cprofile=function(t,n,r){var i,s,o;i=e("#cprofile");if(!i.length)return;return s=this._build_cprofile_link(r),o=i.find(".ajax"),o.length>=10&&o.last().remove(),i.prepend(s)},n.prototype._build_cprofile_link=function(t){var n,r,i,s,o,a,f,l,c;r=t.getResponseHeader("X-Dropbox-Request-Id"),o=t.getResponseHeader("X-Server-Response-Time")||"-1",s={request_id:""+Constants.REQUEST_ID+"-"+r},a=this.url();if(a.indexOf(Constants.BLOCK_CLUSTER)!==-1)s.block=1;else{c=Constants.BATCH_THUMB_ENDPOINTS;for(f=0,l=c.length;f<l;f++){n=c[f];if(a.indexOf(n)!==-1){s.block=1;break}}}return a=a.replace(/[^/]*\/\/[^/]+/,"").replace(/\?.*$/,""),i=e('<a class="ajax" target="_new" />').attr("href",String(u({path:"/profile/cprofile",query:s}))).text("Ajax: "+a+" ("+o+"ms)"),i},n}(y),S=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t;return t=this.next.data(),Constants.GANDALF_PANEL?e.extend({gandalf_panel:1},t):t},n.prototype.success=function(e,t,n){return this._report_gandalf(e,t,n),this.next.success(e,t,n)},n.prototype._report_gandalf=function(t,n,r){var i;if(e("#gandalf_panel").length&&this.url().substring(0,14)!=="/gandalf_panel")return(i=window.gandalf_panel)!=null?i.add(this.url(),r.getResponseHeader("X-Dropbox-Request-Id")):void 0},n}(y),C=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.error=function(e,t,n){return this._log_error(e,t,n),this.next.error(e,t,n)},t.prototype._log_error=function(e,t,n){var r,i;if(t!==0&&t<400)return;return r={url:this.url(),response_code:e.status,source_type:"web",request_id:e.getResponseHeader("X-Dropbox-Request-Id")},i=u({path:"/web_response_code_log"}),p({url:i,data:r})},t}(y),w=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.error=function(e,t,n){return this._notify_dev(e,t,n),this.next.error(e,t,n)},n.prototype._notify_dev=function(t,n,r){var s,u,a;if((typeof Constants!="undefined"&&Constants!==null?!Constants.IS_PROD:!void 0)&&t.status===500&&t.getResponseHeader("X-Debug-Url"))return a=t.getResponseHeader("X-Debug-Url"),s=e("<span />"),s.text(o.DEFAULT_ERROR),u=e("<a/>",{href:a,target:"_blank"}).text(V("View debug")),s.append("&nbsp;").append(u),o.error(new i(s.html()))},n}(y),j=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.success=function(e,t,n){var r;return n.responseText.length?n.responseText.indexOf(_)===0?(r=n.responseText.substr(_.length),o.error(r),this.next.error(n,t,"server error response")):this.next.success(e,t,n):this.next.error(n,t,"empty response")},t}(y),F=function(e){function t(){return this._clear_working_msg=__bind(this._clear_working_msg,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.request=function(e){return this.xhr=e,setTimeout(function(e){return function(){if(e._request_finished())return;if(e._should_show_working_msg())return e._show_working_msg(),e.xhr.done(e._clear_working_msg)}}(this),4e3),this.next.request(this.xhr)},t.prototype._request_finished=function(){return this.xhr.readyState===4},t.prototype._should_show_working_msg=function(){return o.isShown()&&o.current()!==l.undo_notification},t.prototype._show_working_msg=function(){return this.notification=o.success(V("Still working..."))},t.prototype._clear_working_msg=function(){if(o.isShown()&&this.notification===o.current())return o.clear()},t}(y),L=function(t){function n(){return this._watch=__bind(this._watch,this),n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t,r;return this.job_id=n.generate_job_id(),t=this.next.data(),r=this.options().subject_user,r&&(this.uid=t[Constants.UID_PARAM_NAME]||String(r)),e.extend({job_id:this.job_id},t)},n.prototype.request=function(e){return this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval),this.next.request(e)},n.prototype.success=function(e,t,n){return this.next.success(e,t,n)},n.prototype.error=function(e,t,n){return this.next.error(e,t,n)},n.prototype.complete=function(e,t){return this._stop(),a.Job.handled(this.job_id),this.next.complete(e,t)},n.prototype._watch=function(){return a.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(this._interval*1.5),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},n.prototype._stop=function(){return clearInterval(this._watch_id),a.ModalProgress.hide()},n.prototype._show_progress_modal=function(){if(this._modal_shown)return;return this._modal_shown=!0,a.ModalProgress.show(this.options().progress_text)},n.prototype._fetch_progress=function(){var e;return e={},this.uid&&(e[Constants.UID_PARAM_NAME]=this.uid),d({url:"/job_status/"+this.job_id,data:e,success:function(e){return function(e,t,n){var r;return n.responseText.indexOf("done")===0?r="1/1":r=n.responseText,a.ModalProgress.update(r)}}(this),error:function(e){return function(t,n,r){e._failures++;if(e._failures<3)return;return e._stop(),e.next.error(t,n,r)}}(this)})},n.generate_job_id=function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(Math.random()*1e6).toString().lpad(6),n+t},n}(y),h=function(e){function t(){return this._watch=__bind(this._watch,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.data=function(){var e,t;return e=this.next.data(),t=this.options().subject_user,t&&(this.uid=e[Constants.UID_PARAM_NAME]||String(t)),e},t.prototype.success=function(e,t,n){return this._is_async_job_response(n)?(this.job_id=n.responseText.split(":")[1],this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval)):this.next.success(e,t,n)},t.prototype.complete=function(e,t){if(!this._is_async_job_response(e))return this.next.complete(e,t)},t.prototype._is_async_job_response=function(e){var t,n;return((n=e.responseText)!=null?n.indexOf(M):void 0)!==0?!1:(t=e.responseText.split(":")[1],t.match(/^[A-Za-z0-9_\-=]*$/))},t.prototype._watch=function(){return a.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(this._interval*1.5),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},t.prototype._stop=function(){return clearInterval(this._watch_id),a.ModalProgress.hide()},t.prototype._show_progress_modal=function(){if(this._modal_shown)return;return this._modal_shown=!0,a.ModalProgress.show(this.options().progress_text)},t.prototype._fetch_progress=function(){var e;return e={},this.uid&&(e[Constants.UID_PARAM_NAME]=this.uid),d({url:"/async_task_status/"+this.job_id,data:e,success:function(e){return function(t,n,r){var s,u,f;return f=r.responseText,f.indexOf(A)===0?(a.Job.handled(e.job_id),e._stop(),f=f.substr(A.length),r.responseText=f,e.next.success(f,n,r),e.next.complete(r,n)):f.indexOf(_)===0?(a.Job.handled(e.job_id),e._stop(),s=f.substr(_.length),o.error(s),e.next.error(r,n,"server error response"),e.next.complete(r,n)):f.indexOf(O)===0?(a.Job.handled(e.job_id),e._stop(),u=f.substr(O.length),o.error(new i(u)),e.next.complete(r,n)):a.ModalProgress.update(f)}}(this),error:function(e){return function(t,n,r){e._failures++;if(e._failures<3)return;return e._stop(),e.next.error(t,n,r),e.next.complete(t,n)}}(this)})},t}(y),c=[B,g,m,H],p=function(e){return e==null&&(e={}),D(e,c)},k=[F],b=[C,w,S,E,P],N=[h],q=[].concat(k,[j],b,c,N),z=function(e){return e==null&&(e={}),D(e,q)},x=[].concat(k,b,c,N),T=function(e){return e==null&&(e={}),D(e,x)},R=[].concat(k,[j],b,c,[L],N),U=function(e){return e==null&&(e={}),D(e,R)},d=function(e){return e==null&&(e={}),D(e,[].concat(b,c))},I=function(t){var n,r,i;return t==null&&(t={}),n=new v(t),r=W(n,c),i=e.ajax({url:r.url(),type:"OPTIONS",noDropboxDefaults:!0,data:r.data(),success:function(e,t,n){return r.success(e,t,n)},error:function(e,t,n){return r.error(e,t,n)},complete:function(e,t){return r.complete(e,t)}}),r.request(i)},X={Request:D,AuthenticatedRequest:p,BackgroundRequest:d,WebRequest:z,FormWebRequest:T,WebProgressRequest:U,ValidationSchemaRequest:I},X}),define("packaged/core-definition",["modules/core/browser","modules/core/controller_registry","modules/core/cookies","modules/core/dom","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/instantiate","modules/core/kwargs","modules/core/notify","modules/core/ordered_dictionary","modules/core/uri","modules/clean/hi_res","modules/clean/ajax","modules/clean/job_progress","modules/clean/undo"],function(){return!0});