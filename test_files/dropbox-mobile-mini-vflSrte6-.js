define("mobile",["modules/core/controller_registry","modules/clean/datetime","modules/core/i18n","modules/clean/base64","modules/core/dom","modules/core/uri","modules/core/cookies","modules/clean/event_load","libs_mobile","modules/clean/image_size","modules/clean/components/ajax_form","modules/clean/viewer","modules/core/ordered_dictionary","modules/clean/uirequest","jquery","modules/core/exception","modules/clean/analytics","modules/clean/photos/legacy_thumb_loader","modules/core/browser","modules/clean/ajax","modules/clean/sprite","modules/clean/filepath","modules/core/notify","modules/core/html"],function(G,f,L,p,b,C,E,c,x,u,d,h,K,Q,A,e,H,o,S,B,R,s,J,P){window.LEGACY_JS={};var D=L.ungettext;var U=L._;var v=L.N_;var r=L.E_;var t=L.render_sentences;var a=u.image_best_fit_size;var M=e.alertd;var F=e.assert;var g=e.reportException;var w=e.stackTrace;var y=[].slice;if(!window.$j){window.$j=window.jQuery}if(!Function.prototype.bind){Function.prototype.bind=function(V){var Z,Y,W,X;if(typeof monkey_check==="function"){monkey_check()}if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}Z=Array.prototype.slice.call(arguments,1);X=this;W=function(){};Y=function(){return X.apply((this instanceof W&&V?this:V),Z.concat(Array.prototype.slice.call(arguments)))};W.prototype=this.prototype;Y.prototype=new W();return Y}}jQuery.fn.curry=function(){var V,X,W;X=arguments[0],W=arguments[1],V=3<=arguments.length?y.call(arguments,2):[];if(W==null){W=window}if(typeof monkey_check==="function"){monkey_check()}return function(){var Y;Y=1<=arguments.length?y.call(arguments,0):[];return X.apply(W,y.call(V).concat(y.call(Y)))}};jQuery.fn.stripTags=function(V){if(typeof monkey_check==="function"){monkey_check()}return V.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")};jQuery.fn.controller=function(V){if(typeof monkey_check==="function"){monkey_check()}if(V!=null){return this.data("jscontroller",V)}else{return this.data("jscontroller")}};jQuery.fn.hasScrollBar=function(){if(typeof monkey_check==="function"){monkey_check()}return this.get(0).scrollHeight>this.height()};jQuery.fn.viewportOffset=function(){if(typeof monkey_check==="function"){monkey_check()}return b.viewport_offset(this)};jQuery.fn.visible=function(){if(typeof monkey_check==="function"){monkey_check()}return jQuery(this).is(":visible")};jQuery.fn.clonePosition=function(W,V){if(typeof monkey_check==="function"){monkey_check()}b.clone_position(this,W,V);return this};jQuery.format=function(W,V){if(typeof monkey_check==="function"){monkey_check()}return W.replace(/\{([^}]+)\}/g,function(Y,X){if(X in V){return V[X]}else{return Y}})};jQuery.cachedScript=function(W,V){if(typeof monkey_check==="function"){monkey_check()}V=$j.extend(V||{},{dataType:"script",cache:true,url:W});return jQuery.ajax(V)};jQuery.browser=S;jQuery.addSubjectParam=function(X,V){var W;if(typeof monkey_check==="function"){monkey_check()}if(X.subject_user&&!((W=X.data)!=null?W[Constants.UID_PARAM_NAME]:void 0)){return V[Constants.UID_PARAM_NAME]=String(X.subject_user)}};jQuery.ajaxPrefilter(function(V,Y,X){var W;if(!Y.noDropboxDefaults){W={t:E.read(Constants.JS_CSRF_COOKIE),is_xhr:true};jQuery.addSubjectParam(Y,W);if(jQuery.ajaxSettings.restrict!=null){W.restrict=jQuery.ajaxSettings.restrict}V.data=$j.param($j.extend(Y.data,W),Y.traditional);return false}});jQuery.ajax.retryOnce=function(Y,V,W){var X;if(typeof monkey_check==="function"){monkey_check()}if(V!=="abort"&&((X=Y.status)===0||X===500||X===502||X===503)&&!this.xhr_retry){this.xhr_retry=true;return jQuery.ajax(this)}};window.set_csrf_token=function(){return $j.ajaxSetup({data:{t:E.read(Constants.JS_CSRF_COOKIE)}})};window.is_iphone=function(){return navigator.userAgent.search("iPhone")>-1};window.is_winphone7=function(){return navigator.userAgent.search("Windows Phone OS")>-1};window.is_android=function(){return navigator.userAgent.search("Android")>-1};window.parse_url=function(V){var W;W=C.parse(V);if(W.fragment){return W.fragment}return V};window.supports_history=window.history&&window.history.pushState;window.history_stack=[window.location.href];window.pop_history=function(){var V;history_stack.pop();V=window.location.href.split("dropbox.com")[1];return browse_ajax(parse_url(V))};window.current_page=function(){return $j(".page").attr("id")};window.current_href=window.location.href;window.watch_page_history=function(){if(current_page()!=="home"){return}$j(window).on("popstate",function(V){if(parse_url(window.location.href)!==parse_url(current_href)){return pop_history()}});if(!supports_history){return setInterval(function(){if(parse_url(window.location.href)!==parse_url(current_href)){return pop_history()}},500)}};window.manual_resize=function(){var X,W,V;X=current_page();if(!X){return}if(X==="share"){V=$j("#share div.ui-content a").width();return resize_share_input(V)}else{if(X==="home"||X==="search"){V=$j(window).width();return resize_search_input(V)}else{if(X==="login"||X==="register"){W=$j("#register-page").css("display");if(W&&W!=="none"){V=$j("#register-page .ui-input-text").width()}else{V=$j(".ui-input-text").width()}return resize_form_inputs(V)}}}};window.resize_share_input=function(V){return $j("#share div.ui-content input").css({width:V-13})};window.resize_search_input=function(V){$j("div.search-bar div.ui-block-a").css({width:V-41-5});return $j("div.search-bar div.ui-input-search").css({width:V-41-10-30-5})};window.resize_form_inputs=function(V){return $j("form input.ui-input-text").css({width:V-8})};window.device_width=$j(window).width();window.watch_orientation_change=function(){if(is_winphone7()){return setInterval(function(){var V;if($j(window).width()!==V){V=$j(window).width();return manual_resize()}},1000)}else{return $j(window).on("orientationchange",function(){return setTimeout(manual_resize,200)})}};window.page_reset=function(){var V;manual_resize();V=current_page();if(V==="register"){if($j("#register form #tos_checkbox").prop("checked")){$j("#tos_r .ui-checkbox .ui-icon").addClass("ui-icon-checkbox-active")}}else{if(V==="login"){if(!$j("#login form #remember_me_checkbox").prop("checked")){$j("#remember_me_l .ui-checkbox .ui-icon").addClass("ui-icon-checkbox");$j("#remember_me_l .ui-checkbox .ui-icon").removeClass("ui-icon-checkbox-active")}}}return $j(".search_box").on("input",function(){if($j(this).val().length>0){return $j(".ui-input-clear").removeClass("ui-input-clear-hidden")}else{if(!$j(".ui-input-clear").hasClass("ui-input-clear-hidden")){return $j(".ui-input-clear").addClass("ui-input-clear-hidden")}}})};window.setup_touch_events=function(){var W,V,X;W=is_iphone()||is_android();V=(W&&"touchstart mousedown")||"mousedown";X=(W&&"touchend mouseup touchcancel touchmove")||"mouseup touchend click touchcancel touchmove";if(is_winphone7()){return $j("#menu_toggle").on(V,toggle_menu)}else{$j(".file-listing.ui-li, .file-up.ui-li").on(V,function(){if(!$j(this).hasClass("donotselect")){return $j(this).addClass("selected")}});$j(".file-listing.ui-li,.file-up.ui-li").on(X,function(){return $j(this).removeClass("selected")});$j(".ui-btn").on(V,function(){return $j(this).addClass("selected")});$j(".ui-btn").on(X,function(){return $j(this).removeClass("selected")});$j("#menu_toggle").on("click",toggle_menu);$j("#menu_toggle").on(X,toggle_menu);$j(".ui-listview").on(V,".file-options.ui-li a.ui-btn",function(){return $j(this).addClass("selected")});$j(".ui-listview").on(X,".file-options.ui-li a.ui-btn",function(){return $j(this).removeClass("selected")});$j(".file-listing.ui-li a.file-listing").on(V,function(){$j(this).addClass("selected");return $j(this).parent().addClass("donotselect")});$j(".file-listing.ui-li a.file-listing").on(X,function(){$j(this).removeClass("selected");return $j(this).parent().removeClass("donotselect")});return $j(".folder-link").on("click",browse_click)}};window.watch_locale_selector=function(){return $j("#mobile_locale_selector").on("change",function(){var W,V;W=C(window.location.href).fragment;V=W||window.location.href;return Forms.postRequest("/set_locale",{locale:$j(this).val(),locale_cont:V})})};window.delete_file=function(Y,V,X,W){return $j.ajax({type:"POST",url:"/m/delete_cmd",data:{path:Y,display_name:V,file_id:X,icon:W},success:function(aa){var Z;hide_file(X);$j(".undelete-text").html(aa);$j(".undelete-dialog img").attr("src","/static/images/mobile/icons/bw/"+W+".png");activate_undelete_dialog(X);Z=$j("#"+X+"-undo-delete");return Z.on("click",function(ab){ab.preventDefault();Z.off("click");return undelete_file(Y,X)})}})};window.undelete_file=function(W,V){return $j.ajax({type:"POST",url:"/m/undelete",data:{path:W},success:function(X){show_file(V);hide_undelete_dialog();return clear_undelete_timeout()}})};window.show_file=function(V){return $j("."+V+"-file").show()};window.hide_file=function(V){toggle_file_options(V);return $j("."+V+"-file").hide()};window.clear_undelete_timeout=function(){if(typeof undelete_timeout!=="undefined"&&undelete_timeout!==null){return clearTimeout(undelete_timeout)}};window.hide_undelete_dialog=function(){return $j(".undelete-dialog").hide()};window.activate_undelete_dialog=function(W){var V;$j(".undelete-dialog").insertBefore("."+W+"-file");$j(".undelete-dialog").show();clear_undelete_timeout();return V=setTimeout(hide_undelete_dialog,7000)};window.toggle_search=function(){var V;$j("#search_dropdown").toggle();if($j("#search_dropdown").is(":visible")){clear_search();$j(".search_box").focus()}if($j("#search_dropdown .curtain").height()===0){V=$j(document).height()-$j("#search_dropdown").height();return $j("#search_dropdown .curtain").css({height:V+"px"})}};window.validate_search=function(){var V;V=$j("#search_string").val();if(!V){M(U("Please enter a search"));return false}return true};window.clear_search=function(){if($j(".search_box").val().length>0){$j(".search_box").val(this.defaultValue);return $j(".ui-input-clear").addClass("ui-input-clear-hidden")}};window.toggle_menu=function(W,V,X){if(V){M(V.type+" "+X.id)}if($j(".ui-content.main-page").hasClass("hide")){$j(".ui-content.main-page").removeClass("hide")}else{$j(".ui-content.main-page").addClass("hide")}$j("#menu_dropdown").toggle();return setTimeout(function(){return window.scrollTo(0,1)},0)};window.browse_click=function(){browse_ajax($j(this).attr("href"),true);return false};window.browse_ajax=function(W,V){if(W.length){if(W.indexOf("/")===!0){W="/"+W}if(W.indexOf("//")===0){W=""}}return $j.ajax({url:window.location.protocol+"//"+window.location.host+W,success:function(Y){var X;$j("#main")[0].innerHTML=Y;page_reset();setup_touch_events();if(V&&supports_history){window.history.pushState(null,null,W);history_stack.push(W);return X=W}else{if(V){window.location.href="#"+W;W=window.location.href;history_stack.push(parse_url(W));return X=parse_url(W)}}}})};window.up_directory=function(W){var V;if(supports_history&&history_stack.length>1){V=history_stack[history_stack.length-2];if(parse_url(V)===parse_url(W.href)){window.history.back();return false}}return true};window.close_file_options=function(){$j(".file-options:visible").hide();$j("a span.ui-icon.ui-icon-file-options-selected").addClass("ui-icon-file-options");return $j("a span.ui-icon.ui-icon-file-options-selected").removeClass("ui-icon-file-options-selected")};window.toggle_file_options=function(X,W,ag,ae,ab,ad,Y){var af,V,aa,ac,Z;V=$j("."+X+"-options").is(":visible");close_file_options();if(!V){if($j("."+X+"-options").length){$j("."+X+"-options").toggle()}else{new_file_options(X,W,ag,ae,ab,ad,Y)}af=$j(window).height();Z=$j(window).scrollTop();ac=$j("."+X+"-options").position().top;aa=$j("."+X+"-file").height()+1;if(is_winphone7()&&Math.abs(ac-$j(document).height())<aa){$j(window).scrollTop(999999)}else{if(is_android()&&Math.abs(af+Z-ac)<aa*2){$j(window).scrollTop(ac-af+aa*2)}else{$j("."+X+"-file")[0].scrollIntoView()}}$j("."+X+"-file a span.ui-icon").removeClass("ui-icon-file-options");return $j("."+X+"-file a span.ui-icon").addClass("ui-icon-file-options-selected")}};window.new_file_options=function(ac,Y,ab,X,Z,V,aa){var W;W=P.tmpl("quick-actions-tmpl",{id:ac,share_text:U("Share link"),delete_text:U("Delete")}).toHTML();W=$j(W);W.insertAfter("."+ac+"-file");if(!aa){$j("."+ac+"-options .delete-button").on("click",function(ad){ad.preventDefault();return delete_file(ab,X,ac,Z)})}else{$j("."+ac+"-options .delete-button").addClass("disabled")}$j("."+ac+"-options .share-button").on("click",function(ad){ad.preventDefault();shmodel_file(ab);return false});return W};window.shmodel_file=function(W){var V;V=C({path:"/sm/create"+s.normalize(W)}).updateQuery(Constants.UID_PARAM_NAME,Constants.uid);return Forms.postRequest(V.toString())};window.kill_notification=function(){create_cookie(Constants.MOBILE_AD_COOKIE,p.encode("ptz"),Constants.MOBILE_AD_COOKIE_EXPIRES);return $j("#notification_box").toggle()};window.check_tos=function(){$j("#register form #tos_checkbox").prop("checked",true);return $j("#tos_r .ui-checkbox .ui-icon").addClass("ui-icon-checkbox-active")};window.uncheck_tos=function(){$j("#register form #tos_checkbox").prop("checked",false);return $j("#tos_r .ui-checkbox .ui-icon").removeClass("ui-icon-checkbox-active")};window.login_link=LEGACY_JS.login_link=function(){$j("#login-page").show();$j("#register-page").hide();$j("#login_link_div").hide();$j("#sign-in-link").hide();$j("#create_account_link_div").show();$j("#register-link").show();$j("#header_txt").html(U("Sign in"));return false};window.create_account_link=LEGACY_JS.create_account_link=function(){$j("#login-page").hide();$j("#register-page").show();$j("#login_link_div").show();$j("#sign-in-link").show();$j("#create_account_link_div").hide();$j("#register-link").hide();$j("#header_txt").html(U("Create account"));return false};window.send_desktop_install_reminder=function(V){$j("#send-email").hide();$j("#email-sent").show();$j("#email-link").removeAttr("onclick");return $j.ajax({url:"/m/send_download_reminder",type:"POST",data:{token:V}})};window.create_cookie=function(W,X,Z){var Y,V;Y=""+W+"="+X+";";if(Z){V=new Date();V.setTime(V.getTime()+(Z*24*60*60*1000));Y+=" expires="+(V.toGMTString())+";"}Y+=" path=/";return document.cookie=Y};window.delete_cookie=function(V){return create_cookie(V,"",-1)};window.jquery_set_onreadystatechange=function(){return $j.ajaxPrefilter(function(W,V,Y){var X;if(W.onreadystatechange){X=W.xhr;return W.xhr=function(){var Z,aa;aa=X.apply(this,arguments);Z=function(){return W.onreadystatechange(aa,Y)};if(aa.addEventListener){aa.addEventListener("readystatechange",Z,false)}return aa}}})};String.prototype.snippet=function(W){var Y,X,V,Z;if(W==null){W=50}if(this.length<=W){return this}Y="...";W-=Y.length;X=Math.floor(W*0.75);V=W-X;Z=this.length-V;return this.substr(0,X)+Y+this.substr(Z,V)};window.fn_extensions=function(){var V,Y,W,X;W=Array.prototype.slice;X=function(ac,Z){var ab,aa;ab=ac.length;aa=Z.length;while(aa--){ac[ab+aa]=Z[aa]}return ac};Y=function(aa,Z){aa=W.call(aa,0);return X(aa,Z)};V=function(ab){var aa,Z;if(arguments.length<2&&(typeof arguments[0]==="undefined")){return this}Z=this;aa=W.call(arguments,1);return function(){var ac;ac=Y(aa,arguments);return Z.apply(ab,ac)}};return{bind2:V}};if(!Object.keys){Object.keys=(function(){var V,X,W;W=Object.prototype.hasOwnProperty;X=!{toString:null}.propertyIsEnumerable("toString");V=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];return function(ac){var Z,ad,Y,ab,aa;if(typeof ac!=="object"&&typeof ac!=="function"||ac===null){throw new TypeError("Object.keys called on non-object")}Y=[];for(ad in ac){if(W.call(ac,ad)){Y.push(ad)}}if(X){for(ab=0,aa=V.length;ab<aa;ab++){Z=V[ab];if(W.call(ac,V[i])){Y.push(Z)}}}return Y}})()}set_csrf_token();c.window_load(setup_touch_events);$j(watch_page_history);$j(page_reset);watch_orientation_change();watch_locale_selector();jquery_set_onreadystatechange();$j.extend(Function.prototype,fn_extensions());window.DomUtil=LEGACY_JS.DomUtil={fillVal:function(ab,Y){var V,aa,X,Z,W;Z=A("."+Y);W=[];for(aa=0,X=Z.length;aa<X;aa++){V=Z[aa];if(V.tagName==="INPUT"){V.value=ab;W.push(V.defaultValue=ab)}else{W.push(V.innerHTML=ab)}}return W},fromElm:function(V){F(A(V),"No elements match this selector");return A(V)[0].innerHTML}};window.Util=LEGACY_JS.Util={keep_cont_params:function(W){var X,V;if(window.location.search.indexOf("cont")!==-1){X=A(W);V=X.attr("href");X.attr("href",""+V+window.location.search)}},urlquote:function(V){return V.split("/").map(encodeURIComponent).join("/")},unquote:function(V){return V.split("/").map(decodeURIComponent).join("/")},watch_async_task:function(Y,X,aa,ab,V,W){var Z;if(!X.match(/^[A-Za-z0-9_\-=]*$/)){return}if(W){Z=function(){if(V){return V()}}}else{Z=function(){return setTimeout(((function(ac){return function(){return Util.watch_async_task(Y,X,aa,ab,V,true)}})(this)),5000)}}return A.ajax({url:"/async_task_status/"+X,type:"POST",subject_user:Y,success:(function(ac){return function(ad){if(aa&&ad.indexOf("done:")===0){return aa(ad.substr(5))}else{if(V&&ad.indexOf("err:")===0){return V(ad.substr(4))}else{if(ab){ab(ad)}return setTimeout((function(){return Util.watch_async_task(Y,X,aa,ab,V)}),5000)}}}})(this),error:Z})},is_retina_display:window.devicePixelRatio>1,hashString:function(X){var W,V;W=0;V=0;while(V<X.length){W=((W<<5)-W)+X.charCodeAt(V);W=W&W;V++}return W},preloaded_images:{},preload_image:function(X,W){var V;if(Util.preloaded_images[X]){return}V=new Image();if((W!=null)&&W){A(V).error(W)}V.src=X;return Util.preloaded_images[X]=V},get_preloaded_image:function(V){if(Util.preloaded_images[V]){return A(Util.preloaded_images[V])}else{return A('<img src="'+V+'" />')}},video_elm:function(X,Y,Z,W){var V;V=A("<video></video>").attr("src",X);if(Y){A(V).attr("autoplay","true")}if(Z){A(V).attr("poster",Z)}if(W){A(V).attr("controls","1")}return V},get_preview_img_dimensions:function(Y){var X,aa,V,Z,W;V={width:A("#file-preview-modal .preview").width()||A(window).width(),height:A("#file-preview-modal .preview").height()||A(window).height()};aa={width:Y.naturalWidth,height:Y.naturalHeight};X=aa.width/V.width;W=aa.height/V.height;Z=Math.max(X,W);if(Z<1){return false}else{return{width:Math.floor(aa.width/Z),height:Math.floor(aa.height/Z)}}},track_twitter_chars_left:function(W,X){var V;clearInterval(Util.chars_left_interval);V=function(){var Y,Z;Y=A("#twitter-chars");Z=X-A("#"+W).val().trim().length;if(Z<0){Y.addClass("too-long")}else{Y.removeClass("too-long")}return Y.text(Z)};return Util.chars_left_interval=setInterval(V,250)},screen_width:null,set_screen_width:function(V){if(Util.screen_width!==window.innerWidth){Util.screen_width=window.innerWidth;if(V){return V()}}else{return setTimeout(Util.set_screen_width,1)}},resize_inputs:function(){var V;V=window.innerWidth-30;return A("input[type=text], input[type=password], input[type=email], textarea").outerWidth(V)},_batch_thumb_endpoints:null,load_thumbs_in_view:function(ab){var X,af,ad,Z,ai,ac,ah,V,ag,aa,W,aj,Y,ae;ag=A(ab);if(!ag.length){return}aj=A(window).scrollTop();W=A(window).height();aa=ag.first().offset().top;for(Z=Y=0,ae=ag.length;Y<ae;Z=++Y){V=ag[Z];V=ag[Z];if(A(V).hasClass("thumb-loaded")){continue}if(A(V).offset().top>aa){aa=A(V).offset().top}if(aa>aj-W&&aa<aj){if(typeof af==="undefined"||af===null){af=Z}ac=Z}else{if(aa>aj&&aa<aj+W){if(typeof ad==="undefined"||ad===null){ad=Z}ah=Z}else{if(aa>aj+W&&aa<aj+8*W){if(typeof X==="undefined"||X===null){X=Z}ai=Z}}}}return Util._load_thumbs_from_indices(ag,ad,ah,X,af,ai,ac)},_load_thumbs_from_indices:function(ac,ai,al,aj,ag,ae,V){var X,af,ah,ak,ab,aa,Y,W,am,ad,Z;aa=function(an){return A(an).parent().addClass("thumb-loaded")};X=15;af=[];ab=[[ai,al],[aj,ae],[ag,V]];for(Y=0,am=ab.length;Y<am;Y++){ah=ab[Y];for(ak=W=ad=ah[0],Z=ah[1];ad<=Z?W<=Z:W>=Z;ak=ad<=Z?++W:--W){af.push(A(ac[ak]).find("img")[0])}}return o.batch_load_thumbs(af,X,aa)},blackout_background:function(W,V){A("body").addClass("blackout");A(W).addClass("no-opacity");return A(V).addClass("no-opacity")},unblackout_background:function(W,V){A("body").removeClass("blackout");A(W).removeClass("no-opacity");return A(V).removeClass("no-opacity")},desktop_friendly_touchend:("ontouchend" in window?"touchend":"click"),desktop_friendly_touchstart:("ontouchstart" in window?"touchstart":"click"),hide_url_bar:function(){return setTimeout((function(){return window.scrollTo(0,1)}),100)},smart_window_load:function(V){if(document.readyState==="complete"){return setTimeout(V,0)}else{return A(window).on("load",V)}}};window.TouchUtil=LEGACY_JS.TouchUtil={doubletap:function(Y,X){var V,W;V=25;W=function(ac){var Z,ad,ab,aa;ac=ac.originalEvent;Z=function(){return this.touch=false};ab=A.proxy(Z,this);if(!(ac.touches.length===1&&ac.changedTouches.length===1)){ab();return}aa=ac.changedTouches[0];if(this.touch){ad={x:Math.abs(aa.clientX-this.touch.x),y:Math.abs(aa.clientY-this.touch.y)};if(ad.x>V||ad.y>V){ab();return}return X()}else{this.touch={x:aa.pageX,y:aa.pageY};return setTimeout(ab,250)}};return A(Y).bind("touchstart",W)},gesturestart:function(X,W){var V;if(is_iphone()){return A(X).bind("gesturestart",W)}else{V=function(Y){Y=Y.originalEvent;if(Y.touches.length>1||Y.changedTouches.length>1){return W()}};return A(X).bind("touchstart",V)}}};var m=[].indexOf||function(X){for(var W=0,V=this.length;W<V;W++){if(W in this&&this[W]===X){return W}}return -1},y=[].slice;window.NOTCLIENTS=LEGACY_JS.NOTCLIENTS={};window.NOTCLIENT_DEBUG=LEGACY_JS.NOTCLIENT_DEBUG=false;window.add_notclient=LEGACY_JS.add_notclient=function(V,X,W){new_notclient(V);return setTimeout((function(){return NOTCLIENTS[V].init(X,W)}),2000)};window.new_notclient=LEGACY_JS.new_notclient=function(an){var aC,aE,ae,ag,ad,ao,al,ax,X,ai,V,Z,ah,aH,Y,aI,ab,at,am,aa,av,af,ak,aD,ar,aJ,aB,aj,aA,W,au,az,ac,ap,aG,ay,aq,aF,aw;F(m.call(NOTCLIENTS,an)<0,"cannot create more than one notclient per user");am=function(aK){return $u.isNumber(aK)&&aK%1===0&&aK>0};at=function(aK){return $u.isNumber(aK)&&aK%1===0&&aK>=0};F(am(an),"user_id must be a positive integer");aa=function(){var aK;aK=1<=arguments.length?y.call(arguments,0):[];if(NOTCLIENT_DEBUG){return console.log.apply(console,aK)}};aC=90000;ag=8096;ao="user";ad="list";Y=false;aE=1000;ae=5*60*1000;aJ=0;ap=function(){var aK;if(Z===0){aK=0}else{aK=Math.min(aE*Math.pow(2,Z-1),ae)}return Math.max(aK,aJ)};aD=null;aB={};aH={};ak=1;aI=false;ab=false;aF=null;ax=false;ay=[];ac=null;V=null;av=null;af={};aj=false;Z=0;aG=0;aq=function(aO,aM){var aL,aK,aN;aN=[];for(aL in aM){aK=aM[aL];aL=parseInt(aL,10);F(am(aL),"ns_ids must be positive integers: "+aL);F(at(aK),"sjids must be nonnegative integers: "+aK);if(aO[aL]!=null){aN.push(aO[aL]=Math.min(aO[aL],aK))}else{aN.push(aO[aL]=aK)}}return aN};X=function(){var aM,aL,aN,aK;F((aD!=null)&&!$u.isEmpty(aB),"expected nid and ns_map");aN={host_int:0,trace:window.location.pathname,rev:Constants.SVN_REV};aM=$u.pluck($u.values(aH),"type");if(m.call(aM,ao)>=0){aN.user_id=an;aN.nid=aD!=null?aD.replace(/^0+(.)/,"$1"):void 0}if(m.call(aM,ad)>=0){aN.ns_map=((function(){var aO;aO=[];for(aL in aB){aK=aB[aL];aO.push(""+aL+"_"+aK)}return aO})()).join(",")}if(C.parse(Constants.SUBSCRIBE_URL).updateQuery(aN).toString().length>ag){delete aN.ns_map}return aN};ai=function(){var aK;if(!Y){return}aK=ap();if(aK>0){return V=window.setTimeout(aw,aK)}else{return aw()}};aw=function(){var aK;F(!aI&&!ab,"connect: invalid state");F(aD>=0||!$u.isEmpty(aB),"notclient: called connect with nothing to subscribe to");aa("###########################");aK=X();if((aK.nid==null)&&!aK.ns_map){aa("nothing to subscribe to. skipping notserver connection.");return}aa("connecting to notserver...");aI=true;aG+=1;return aF=$j.ajax(Constants.SUBSCRIBE_URL,{data:aK,dataType:"json",noDropboxDefaults:true,error:function(){if(ax){ax=false;return}Z+=1;aa("error connecting to notserver. bad rounds="+Z+".");aI=false;return ai()},success:function(aL){aa("notserver connection closed. response:",aL);aI=false;if(aL.chillout!=null){aJ=parseInt(aL.chillout,10)*1000;aa("notserver told us to chill for "+aJ+"ms")}else{if(aJ>0){aa("setting notserver chillout back to 0ms");aJ=0}}if(aL.ret==="punt"){return ai()}else{F(aL.ret==="new","unknown notserver ret: "+aL.ret);F("refresh" in aL,"expected notserver ret:new to have refresh keyword");return az(aL.refresh)}}})};al=function(){if(aF!=null){ax=true;aF.abort();return aF=null}};aA=function(){aJ=0;aI=false;ab=false;al();ay=[];window.clearTimeout(ac);window.clearTimeout(V);ac=null;V=null;av=null;af={};aj=false;Z=0;return ai()};au=function(){var aK;Y=false;aJ=0;aD=null;aB={};aH={};aK=0;ak=1;aI=false;ab=false;aF=null;ax=false;ay=[];window.clearTimeout(ac);window.clearTimeout(V);ac=null;V=null;av=null;af={};aj=false;Z=0;return aG=0};az=function(aP){var aS,aO,aK,aL,aQ,aM,aR,aN;F(!ab&&!aI,"run_handlers: invalid state");F(av===null,"run_handlers: new_nid must start at null");F($u.isEqual(af,{}),"run_handlers: new_ns_map must start at {}");F(!aj,"expected one_or_more_handler_failures=false");ab=true;aa("running handlers...");aL=$u.filter($u.values(aH),function(aU){var aT;return aT=aU.type,m.call(aP,aT)>=0});F(!$u.isEmpty(aL),"notserver sent a ping for unsubscribed activity");ay=$u.pluck(aL,"handler_id");for(aM=0,aR=aL.length;aM<aR;aM++){aN=aL[aM],aS=aN.handler,aO=aN.handler_id,aK=aN.name,aQ=aN.type;aa("running id="+aO+", name="+aK+", type="+aQ);aS()}if($u.isEmpty(ay)){return aa("all handlers already finished running. no need for a slacker timeout.")}else{aa("all handlers running. slacker timeout set.");return ac=window.setTimeout(W,aC)}};W=function(){var aM,aN,aL,aK;F(ab&&!aI,"called report_slackers in an invalid state.");F(!$u.isEmpty(ay,"report_slackers called w/ nothing slackin'"));aa("found some slackers");aj=true;aK=[];for(aN=0,aL=ay.length;aN<aL;aN++){aM=ay[aN];aK.push(ah(aM))}return aK};ah=function(aK){if(m.call(ay,aK)<0){return}aa("done handling: "+aK);ay=$u.without(ay,aK);if($u.isEmpty(ay)){aa("all handlers are done running.");ab=false;window.clearTimeout(ac);if(av!=null){aa("new nid: "+av);aD=av}if(!$u.isEmpty(af)){aa("new ns_map:",af);aB=af}if(aj){Z+=1;aa("one or more handler errors. bad_rounds="+Z)}else{Z=0}av=null;af={};aj=false;return ai()}};ar={get_user_id:function(){return an},get_nid:function(){return aD},get_ns_map:function(){return $u.clone(aB)},get_consecutive_bad_rounds:function(){return Z},get_total_rounds:function(){return aG},get_notserver_chillout_ms:function(){return aJ},get_sleep_ms:ap,subscribe_user:function(aR){var aL,aM,aQ,aP,aO,aK,aN;F(!ab,"adding new handlers from inside handlers is not currently supported");aN=["name","handler"];for(aO=0,aK=aN.length;aO<aK;aO++){aP=aN[aO];F(aR[aP],"subscribe_user requires this param be non-falsey: "+aP)}F($u.isFunction(aR.handler),"handler must be a function");aa("adding user handler "+aR.name);aM=$u.pluck($u.values(aH),"type");aQ=m.call(aM,ao)<0;aL=ak++;aH[aL]={handler_id:aL,handler:aR.handler,name:aR.name,type:ao};if(aQ){aa("first user handler added, reconnecting");aA()}return aL},subscribe_sfj:function(aR){var aL,aM,aQ,aP,aO,aK,aN;F(!ab,"adding new handlers from inside handlers is not currently supported");aN=["name","handler"];for(aO=0,aK=aN.length;aO<aK;aO++){aP=aN[aO];F(aR[aP],"subscribe_sfj requires this param be non-falsey: "+aP)}F($u.isFunction(aR.handler),"handler must be a function");aa("adding sfj handler "+aR.name);aM=$u.pluck($u.values(aH),"type");aQ=m.call(aM,ad)<0;aL=ak++;aH[aL]={handler_id:aL,handler:aR.handler,name:aR.name,type:ad};if(aQ){aa("first sfj handler added, reconnecting");aA()}return aL},handler_success:function(aK,aM){var aL;if(m.call(ay,aK)<0){return}aL=aH[aK].type;if(aL===ad){F("ns_map" in aM,"ns_map required param is missing");F(!("nid" in aM),"nid is disallowed from SFJ handlers");aq(af,aM.ns_map)}else{F(aL===ao,"unknown handler type: "+aL);F("nid" in aM,"nid required param is missing");F(!("ns_map" in aM),"ns_map is disallowed from user handlers");if((av==null)||aM.nid<av){av=aM.nid}}return ah(aK)},handler_failure:function(aK){aa("handler failed. handler_id="+aK);if(m.call(ay,aK)<0){return}aj=true;return ah(aK)},handle_visibility_change:function(){if(window.document.hidden){return al()}else{return aA()}},init:function(aL,aK){F(!Y,"error: init() has been called twice.");aD=aL;aq(aB,aK);Y=true;if(window.document.visibilityState!=null){window.document.on("visibilitychange",this.handle_visibility_change);if(!window.document.hidden){return ai()}}else{return ai()}},reset:au,abort:al,reconnect:aA};NOTCLIENTS[an]=ar;return ar};var T={}.hasOwnProperty;window.Forms=LEGACY_JS.Forms={submitOnlyOnce:function(){var V;V=Forms.submitted!==true;Forms.submitted=true;return V},add_vars:function(X,Y){var Z,W,V;X=A(X);V=[];for(W in Y){if(!T.call(Y,W)){continue}Z=A("<input />").attr("type","hidden").attr("name",W).val(Y[W]);V.push(X.append(Z))}return V},parse_error:function(V,W){return V[W].message_text||V[W].message_html},collect_form_vars:function(Y){var ab,X,W,aa,Z,V;Y=$j(Y||$j(document.body));X=A.merge(Y.find("input"),Y.find("textarea"),Y.find("select"));W={};for(Z=0,V=X.length;Z<V;Z++){ab=X[Z];if(ab.name&&ab.name!=="t"){if(A(ab).attr("type")==="checkbox"&&!A(ab).prop("checked")){continue}aa=A(ab).val();if(aa){if(typeof aa!=="string"){aa=aa.join(",")}if(W[ab.name]!=null){if(typeof W[ab.name]==="string"){W[ab.name]=[W[ab.name],aa]}else{W[ab.name].push(aa)}}else{W[ab.name]=aa}}}}return W},ajax_submit:function(X,W,ab,Y,aa,V){var Z;if(X.ajax_submitted){return false}X.ajax_submitted=true;Z=Forms.collect_form_vars(X);if(V){A.extend(Z,V)}A.ajax({url:W||X.action,type:"POST",data:Z,dataType:aa||"text",success:function(ae,ac,ad){if(ab&&typeof ab==="function"){return ab(ad,ae)}},error:function(ae){var ac,ad;if(ae){if(ae.responseText.indexOf("err:"===0)){ac=ae.responseText.substr(4);if(ac.indexOf("{"===0)){ad=JSON.parse(ac);Forms.fill_errors(X,ad)}else{M(ac)}}else{M("There was a problem completing this request")}}if(Y&&typeof Y==="function"){return Y(ae)}},complete:function(ac){return X.ajax_submitted=false}});return false},clear_errors:function(V){V=V||A(document.body);return V.find(".error-removable").remove()},fill_errors:function(Y,X){var aa,W,Z,V;X=X||{};Y=Y||A(document.body);Forms.clear_errors(Y);V=[];for(Z in X){if(!T.call(X,Z)){continue}aa=Y.find("[name="+Z+"]")||Y.find("[data-error-field-name="+Z+"]");if(aa){W=A("<div></div>").attr("class","error-message error-removable");W.html(Forms.parse_error(X,Z));V.push(W.insertBefore(aa))}else{V.push(void 0)}}return V},postRequest:function(X,Y,V){var W;if(Y==null){Y={}}if(V==null){V={}}F(X!=null,"postRequest missing action");Y.t=E.read(Constants.JS_CSRF_COOKIE);W=A('<form method="POST"></form>').attr("action",X);if(V.target){W.target=V.target}A(document.body).append(W);Forms.add_vars(W,Y);return W.submit()}};window.TwoFactorAuth=LEGACY_JS.TwoFactorAuth={login_init:function(V){return this.login_listen()},login_listen:function(){A("#code").focus();return A("#resend-link").on("click",A.proxy(this._resend_twofactor,this))},_resend_twofactor:function(){return A.ajax({url:"/twofactor_resend",type:"POST",success:(function(V){return function(W){switch(W){case"OK":return J.success(U("We sent you another code. It may take a few minutes to arrive."));case"UNREACHABLE":return V.show_error_unreachable();case"EXPIRED":return V.show_error_expired();case"BADCARRIER":return V.show_error_bad_carrier();case"INVALIDNUMBER":return V.show_error_invalid_number();case"NOTAMOBILE":return V.show_error_not_a_mobile()}}})(this),error:(function(V){return function(){return V._show_error500()}})(this)})},_show_error:function(V){return A(".error-message").text(V)},show_error_unreachable:function(){return this._show_error(U("We couldn't reach your phone number. Are you sure it's correct?"))},show_error_expired:function(){return this._show_error(U("Sorry, your phone code has expired. Please log in again."))},show_error_bad_carrier:function(){return this._show_error(U("Unfortunately, your carrier is not supported at this time."))},show_error_invalid_number:function(){return this._show_error(U("That is not a valid phone number."))},show_error_not_a_mobile:function(){return this._show_error(U("That phone number does not appear to be a valid mobile number."))},show_error500:function(){return this._show_error(U("Sorry, an error occured. Please try again later."))}};var j,q,N,O,n,I,l;window.BrowseFile=LEGACY_JS.BrowseFile={};BrowseFile.CATEGORY_TO_TRANSLATION={FILE:U("file"),FOLDER:U("folder"),SHARED_FOLDER:U("shared folder"),PUBLIC_FOLDER:U("folder"),IMAGE:U("image"),VIDEO:U("video"),AUDIO:U("audio"),DOCUMENT:U("document"),COMPRESSED_FILE:U("archive"),CODE:U("code"),DISK_IMAGE:U("disk image"),EXECUTABLE:U("executable"),SHORTCUT:U("shortcut"),LINK:U("link"),FONT:U("font"),SANDBOX:U("app folder")};BrowseFile._CATEGORIES={IMAGE:"ai bmp cr2 eps gif ico jpeg jpg nef png psd tif tiff svg svgz",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"cdr csv doc docx docm fla indd keynote numbers otf pages pdf ppt pptx pptm pps ppsx ppsm ps rtf swf txt wpd xls xlsx xlsm",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 c coffee cpp cs css cxx h html html java js less php py rb sass scss sh sql vb xhtml xml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"};BrowseFile.EXTENSION_TO_CATEGORY={};I=BrowseFile._CATEGORIES;for(j in I){N=I[j];l=N.trim().split(" ");for(O=0,n=l.length;O<n;O++){q=l[O];BrowseFile.EXTENSION_TO_CATEGORY[q]=j}}window.Photos=LEGACY_JS.Photos={SCROLL_OFFSET:2400,LIGHTBOX_OFFSET:10,POST_SCROLL_WAIT:1,THUMBNAIL_WIDTH:79,THUMB_SELECTOR:"#photos-list .photo-thumb",_photos:[],_duplicates_map:{},_preview_objs:[],_num_total:null,_selected_index:-1,_cursor:null,_current_filter:null,_last_scroll_timeout:null,_prev_date:null,_getting_more:false,_selected_photos:[],_tmpl:null,_more_endpoint:"",_count_endpoint:"",_batch_thumb_endpoints:[],init:function(X,V,W){if(!X.length){A("#cu-empty").show();A("#cu-view").hide();return}this._preload_icons();Util.set_screen_width(A.proxy(this.set_photos_list_width,this));this._more_endpoint="/more_photos";this._count_endpoint="/photos_count";this._tmpl=P.tmpl("mobile_gallery_photo_thumb");if(V){this._cursor=W}else{this._cursor=null}this._render(X);this._listen();return this._get_num_total()},_preload_icons:function(){return Util.preload_image("/static/images/icons/retina-loading.gif")},set_photos_list_width:function(){var V;V=Math.floor(Util.screen_width/this.THUMBNAIL_WIDTH)*this.THUMBNAIL_WIDTH;return A("#photos-list").width(V)},_listen:function(){A(".photo-thumb").bind("click",A.proxy(this._thumb_click,this));A(document).bind(Lightbox.PHOTO_CHANGE_EVT,A.proxy(this._lightbox_event,this));A(document).bind(Lightbox.EXIT_SELECT_EVT,A.proxy(this._after_lightbox_close,this));A(window).bind("scroll",A.proxy(this._window_scroll,this));A(window).bind("scroll",Lightbox.resize_and_update_modal_position);return A(window).bind("orientationchange",function(){return Util.set_screen_width(A.proxy(this.set_photos_list_width,this))})},_render:function(ac){var aa,X,ab,W,Z,Y,V;X=[];ab=void 0;this._update_duplicates_map(ac);if(this._prev_date){Z=this._prev_date}else{Z=new Date(ac[0].time_taken);X.push(this._generate_month_header(Z))}for(Y=0,V=ac.length;Y<V;Y++){W=ac[Y];ab=this._get_newest(W.uniqueness_key);if(this._photos.indexOf(ab)===-1){aa=new Date(ab.time_taken);if(aa.getMonth()!==Z.getMonth()||aa.getFullYear()!==Z.getFullYear()){X.push(this._generate_month_header(aa))}Z=aa;X.push(this._tmpl({photo:ab,thumbnail_url:ab.thumbnail_url,subject_uid:h.get_viewer().personal_user.id}).toHTML());this._photos.push(ab);this._preview_objs.push(this._get_preview_obj(ab))}}this._prev_date=Z;if(this._cursor){A("#cu-loading").show()}A("#photos-list").append(X);if(this._num_total){this._set_lightbox_wrap()}return Util.load_thumbs_in_view(this.THUMB_SELECTOR)},_reset:function(){this._photos=[];this._duplicates_map={};this._preview_objs=[];this._num_total=null;this._cursor=null;this._last_scroll_timeout=null;this._prev_date=null;this._getting_more=false;this._clear_selected();A("#photos-list").__date();return A("#cu-empty").hide()},_update_duplicates_map:function(V){return A.each(V,(function(W){return function(Y,X){if(W._duplicates_map[X.uniqueness_key]){return W._duplicates_map[X.uniqueness_key].push(X)}else{return W._duplicates_map[X.uniqueness_key]=[X]}}})(this))},_get_newest:function(Y){var W,ab,X,aa,V,Z;ab=this._duplicates_map[Y];if(ab.length===0){}else{if(ab.length===1){return ab[0]}else{X=ab[0];Z=ab.slice(1);for(aa=0,V=Z.length;aa<V;aa++){W=Z[aa];if(W.mtime>X.mtime){X=W}}return X}}},_thumb_click:function(W){var V,X;V=A(W.target).parents(".photo-thumb");X=A(".photo-thumb").index(V);return this._preview(X)},_preview:function(V){if(this._num_total){return Lightbox.show(V)}else{return setTimeout(A.fn.curry(this._preview,this,V),100)}},_get_num_total:function(){return A.ajax({url:this._count_endpoint,subject_user:Constants.uid,type:"POST",data:{filter:this._current_filter},success:(function(V){return function(W){V._num_total=W;Lightbox.init(V._preview_objs,{include_delete:true,num_previews:V._num_total,header_selector:"#menu_photos",content_selector:"#content_photos"});return V._set_lightbox_wrap()}})(this)})},_set_lightbox_wrap:function(){if(this._cursor){return Lightbox.set_no_wrap(true)}else{return Lightbox.set_no_wrap(false)}},_window_scroll:function(){var Y,V,X,W;clearTimeout(this._last_scroll_timeout);V=function(){return Util.load_thumbs_in_view(this.THUMB_SELECTOR)};this._last_scroll_timeout=setTimeout(A.proxy(V,this),this.POST_SCROLL_WAIT);if(this._cursor){W=A(window).scrollTop();X=A(window).height();Y=A(document).height();if(W+X+this.SCROLL_OFFSET>=Y){return this._get_more()}}},_lightbox_event:function(W,V){this._selected_index=this._preview_objs.indexOf(V);if(this._cursor&&this._selected_index>this._preview_objs.length-this.LIGHTBOX_OFFSET){return this._get_more()}},_after_lightbox_close:function(){if(this._selected_index>-1){this._scroll_to_thumb(this._selected_index);return this._selected_index=-1}},_get_more:function(){if(this._getting_more){return}this._getting_more=true;return A.ajax({url:this._more_endpoint,subject_user:Constants.uid,type:"POST",data:{cursor:this._cursor,filter:this._current_filter},success:(function(V){return function(W){var X;if(A("#cu-loading")){A("#cu-loading").hide()}X=JSON.parse(W);if(X.more){V._cursor=X.cursor}else{V._cursor=null}V._render(X.photos);V._listen();V._getting_more=false;if(!V._num_total){return V._get_num_total()}}})(this)})},_get_preview_obj:function(W){var V;if(W.preview_type==="photo"&&W.thumbnail_url){return new PhotoPreview(W.filename,W.path,W.thumbnail_url,C.parse(W.href).updateQuery({dl:1}).toString(),W.href,W.display_time_taken)}else{if(W.preview_type==="video"&&W.thumbnail_url&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){if(is_iphone()){V=C({path:"/playlist"+W.path}).updateQuery(Constants.UID_PARAM_NAME,Constants.uid).toString();return new VideoPreview(W.filename,W.path,W.thumbnail_url,C.parse(W.href).updateQuery({dl:1}).toString(),null,W.display_time_taken,null,V)}else{return new PhotoPreview(W.filename,W.path,W.thumbnail_url,C.parse(W.href).updateQuery({dl:1}).toString(),W.display_time_taken)}}}return null},_generate_month_header:function(V){return A("<h1/>",{"class":"blue-h2"}).text(f.format_date(V,"MMMM yyyy"))},scroll_to_thumb:function(V){var Z,Y,X,W;Y=A(V).offset().top;Z=A(V).height();W=A(window).scrollTop();X=A(window).height();if(Y<W||Y+Z>W+X){return setTimeout((function(){return window.scrollTo(0,Y-X/2)}),1)}},_scroll_to_thumb:function(W){var V;V=A(".photo-thumb")[W];if(!V){return}this.scroll_to_thumb(V);return Util.load_thumbs_in_view(this.THUMB_SELECTOR)}};var T={}.hasOwnProperty,k=function(Y,W){for(var V in W){if(T.call(W,V)){Y[V]=W[V]}}function X(){this.constructor=Y}X.prototype=W.prototype;Y.prototype=new X();Y.__super__=W.prototype;return Y};window.FilePreview=LEGACY_JS.FilePreview=(function(){function V(){}V.prototype.fail_image_src="/static/images/preview_fail.png";V.prototype.preload=function(){};V.prototype.render=function(){};V.prototype.show_fail=function(X){var W;W=A("<div></div>").append(U("Unable to preview this item.",{comment:"preview means showing the item in the same browser window without downloading a copy"}));return X.append(W)};return V})();window.PhotoPreview=LEGACY_JS.PhotoPreview=(function(W){k(V,W);function V(X,ab,Z,Y,aa,ac,ad){this.filename=X;this.fq_path=ab;this.thumbnail_url_tmpl=Z;this.dl_url=Y;this.original_url=aa;this.display_time=ac;this.shmodel_link=ad}V.prototype.fallback=function(Y){var X;X=A(Y.target);X.attr({src:this.fail_image_src,width:128,height:128});return this.show_fail(X.parents("div.content-item"))};V.prototype.preload=function(){var Y,X;X=C.parse(this.thumbnail_url_tmpl).updateQuery({size:a()}).toString();Util.preload_image(X,this.fallback.bind2(this));Y=Util.get_preloaded_image(X);Y.attr("class","thumbnail");return Y};V.prototype.render=function(){var Y,Z,X,aa;Y=this.preload();aa=A("<div/>").append(Y);Z=Y.attr("src").length;X=Y.attr("src").substring(Z-this.fail_image_src.length,Z);if(X===this.fail_image_src){this.show_fail(aa)}return aa};V.prototype.get_elm=function(){return A("#file-preview-modal img.thumbnail")[0]};V.prototype.show_loading=function(){var X;if(A("#file-preview-modal .loading-image").length){return}X="<img class='loading-image' src='/static/images/icons/ajax-loader-black-2x.gif'/>";return A("#file-preview-modal .preview-content").append(A(X))};V.prototype.hide_loading=function(){return A("#file-preview-modal .loading-image").remove()};V.prototype.listen_for_click=function(){};return V})(FilePreview);window.VideoPreview=LEGACY_JS.VideoPreview=(function(V){k(W,V);function W(X,ac,aa,Z,ab,ad,ae,Y){this.filename=X;this.fq_path=ac;this.thumbnail_url_tmpl=aa;this.dl_url=Z;this.original_url=ab;this.display_time=ad;this.shmodel_link=ae;this.preview_url=Y}W.prototype.fallback=function(Y){var X;X=A(Y.target);X.attr({src:this.fail_image_src,width:128,height:128});return this.show_fail(X.parents("div.content-item"))};W.prototype.preload=function(){var Y,X;X=C.parse(this.thumbnail_url_tmpl).updateQuery({size:a()}).toString();Util.preload_image(X,this.fallback.bind2(this));Y=Util.get_preloaded_image(X);Y.attr("class","thumbnail");return Y};W.prototype.render=function(){var Y,aa,X,ab,Z;Y=this.preload();Z=Util.video_elm(this.preview_url,false,Y.attr("src"));ab=A("<div></div>").append('<div class="play-button"><img src="/static/images/playbutton2.png" /></div>').append(Y).append(Z);aa=Y.attr("src").length;X=Y.attr("src").substring(aa-this.fail_image_src.length,aa);if(X===this.fail_image_src){this.show_fail(ab)}return ab};W.prototype.get_elm=function(){return A("#file-preview-modal img.thumbnail")[0]};W.prototype.show_loading=function(){};W.prototype.hide_loading=function(){};W.prototype.listen_for_click=function(){var X;X=A(".content-item video")[0];return A(".play-button").bind(Util.desktop_friendly_touchstart,function(Y){Y.stopPropagation();return X.play()})};return W})(FilePreview);window.Lightbox=LEGACY_JS.Lightbox=(function(){var ao,aA,an,at,av,ay,ai,af,X,aa,aw,ak,au,ar,W,ah,aq,az,ac,Z,ae,am,ad,V,ap,ag,aj,Y,al,ab,ax;at=[];aA=0;av=false;Y=void 0;ay=/^\d+\-\d+\-\d+\s+\d+\.\d+\.\d+/;aq=void 0;aa=void 0;ak=function(aB){return A(aB).prop("complete")!==false};am=function(){var aC,aB;Lightbox.resize_and_update_modal_position();aC=at[aA].get_elm();if(!aC||!ak(aC)){return}aB=Util.get_preview_img_dimensions(aC);aC=A(aC);aC.css({visibility:""});if(aB){aC.css({width:aB.width+"px"});return aC.css({height:aB.height+"px"})}else{aC.css({width:""});return aC.css({height:""})}};af=void 0;aj=void 0;ad=void 0;W=false;X=(is_iphone()?"fadeout-iphone":"fadeout");ar=function(){var aB;if(!W){return}aB=A("#file-preview-modal");aB.find(".lightbox-menu").addClass(X);aB.find(".header").addClass(X);aB.find(".prev").addClass(X);aB.find(".next").addClass(X);aB.find(".lightbox-exit").unbind(Util.desktop_friendly_touchstart,V).unbind("touchend",ab).unbind("touchend",ai);aB.unbind(Util.desktop_friendly_touchend,ar);aB.bind(Util.desktop_friendly_touchend,aj);return W=false};ag=function(){var aB;if(af){clearTimeout(af)}if(W){return}aB=A("#file-preview-modal");aB.find(".lightbox-menu").removeClass(X);aB.find(".header").removeClass(X);aB.find(".prev").removeClass(X);aB.find(".next").removeClass(X);aB.find(".lightbox-exit").bind(Util.desktop_friendly_touchstart,V).bind("touchend",ab).bind("touchend",ai);aB.bind(Util.desktop_friendly_touchend,ar);aB.unbind(Util.desktop_friendly_touchend,aj);return W=true};aj=function(){ag();return ad()};ad=function(){return af=setTimeout(ar,3112)};aw=function(aC){var aB;aB=at.length;return(aB+(aA+aC)%aB)%aB};az=function(aB){return at[aB].preload()};Z=function(){var aE,aB,aF,aD,aC;aE=[1,-1,2,-2,3,-3,4,-4];aC=[];for(aF=0,aD=aE.length;aF<aD;aF++){aB=aE[aF];if(Math.abs(aB)<at.length){aC.push(az(aw(aB)))}else{aC.push(void 0)}}return aC};ap=function(aE){var aI,aF,aG,aH,aC,aB,aD;F(aA<at.length,"Invalid index "+aA);aG=at[aA];aI=aG.render();aI.addClass("content-item");aF=A("#file-preview-modal");aH=aF.find(".preview-content");aB=aI.find("img.thumbnail");if(aG instanceof PhotoPreview){aD=function(){return window.location.href=C.parse(aG.thumbnail_url_tmpl).updateQuery({size:"1024x768"}).toString()};TouchUtil.doubletap(aB,aD);TouchUtil.gesturestart(aB,aD)}aB.hide();aH.html(aI);aF.find(".current_index").text(aA+1);aF.find(".total").text(aq.num_previews||at.length);if(aG.display_time){if(aG.filename.match(ay)){aF.find(".filename").text(aG.display_time)}else{aF.find(".filename").text(aG.filename.snippet(20)+" - "+aG.display_time)}}else{aF.find(".filename").text(aG.filename.snippet(40))}aF.find(".filename").attr("title",aG.filename);if(at.length===1){aF.find(".prev").hide();aF.find(".next").hide()}else{if(aA===0&&aq.no_wrap){aF.find(".prev").hide();aF.find(".next").show()}else{if(aA===at.length-1&&aq.no_wrap){aF.find(".prev").show();aF.find(".next").hide()}else{aF.find(".prev").show();aF.find(".next").show()}}}aC=!Lightbox.shown;if(!ak(aB)){if(aC){ag()}aG.show_loading();aB.load(function(){if(aC){ad()}aG.hide_loading();am();aB.show();return aG.listen_for_click()})}else{if(aC){aj()}am();aB.show();aG.listen_for_click()}if(!aC){if(aE){aj()}else{ar()}}A(document).trigger(Lightbox.PHOTO_CHANGE_EVT,aG);history.replaceState({lightbox:true},"","#f:"+Util.urlquote(at[aA].filename));return Z()};ah=function(aC){var aB;aB=A("#file-preview-modal").find(".next");aB.addClass("pressed");if(aC){aC.stopPropagation()}if(aA===at.length-1&&aq.no_wrap){return}setTimeout((function(){var aD;aA=aw(1);aD=aA===0;ap(aD);return aB.removeClass("pressed")}),3);return false};ae=function(aC){var aB;aB=A("#file-preview-modal").find(".prev");aB.addClass("pressed");if(aC){aC.stopPropagation()}if(aA===0&&aq.no_wrap){return}setTimeout((function(){aA=aw(-1);ap();return aB.removeClass("pressed")}),3);return false};ao=function(){return false};ai=void 0;al=function(){var aB;aB=A("#file-preview-modal");aB.find(".next").unbind(Util.desktop_friendly_touchend,ah);aB.find(".prev").unbind(Util.desktop_friendly_touchend,ae);aB.find(".lightbox-exit").unbind(Util.desktop_friendly_touchstart,V).unbind("touchend",ab).unbind("touchend",ai);A(window).unbind("popstate",ai);A(document).unbind("touchmove",ao);clearInterval(Y);return av=false};V=function(aB){return A(aB.target).parent().addClass("selected")};ab=function(aB){return A(aB.target).parent().removeClass("selected")};aa=function(){var aB;if(!Lightbox.shown){return}aB=A("#file-preview-modal");aB.hide();aB.find(".preview-content").empty();A(document.body).removeClass("full-no-overflow");ar();al();return Lightbox.shown=0};an="db:filepreview:exitselect";ai=function(aB){aB.stopPropagation();aB.preventDefault();if(aB&&aB.originalEvent.type==="popstate"&&(!aB.originalEvent.state||aB.originalEvent.state.lightbox)){return}Util.unblackout_background(aq.header_selector,aq.content_selector);aa();history.replaceState({},"","#");A(document).trigger(an,at[aA]);return false};au=function(){var aB;if(!av){aB=A("#file-preview-modal");aB.find(".next").bind(Util.desktop_friendly_touchend,ah);aB.find(".prev").bind(Util.desktop_friendly_touchend,ae);aB.find(".lightbox-exit").bind(Util.desktop_friendly_touchstart,V).bind("touchend",ab).bind("touchend",ai);A(window).bind("popstate",ai);A(document).bind("touchmove",ao);av=true}return Y=setInterval(am,500)};ax=function(){var aC,aD,aF,aE,aB;aC=C.parse(window.location.href).fragment.substr(2);if(aC){for(aD=aE=0,aB=at.length;aE<aB;aD=++aE){aF=at[aD];if(aC===aF.filename){aA=aD;if(!Lightbox.shown){Lightbox.show()}return}}return history.replaceState({},"","#")}};ac=function(){var aB;aB="/static/images/mobile/thebest/";Util.preload_image(aB+"lightbox_exit.png");Util.preload_image(aB+"lightbox_exit_pressed.png");Util.preload_image(aB+"lightbox_right_arrow.png");Util.preload_image(aB+"lightbox_right_arrow_pressed.png");Util.preload_image(aB+"lightbox_left_arrow.png");Util.preload_image(aB+"lightbox_left_arrow_pressed.png");Util.preload_image("/static/images/icons/ajax-loader-black-2x.gif");Util.preload_image("/static/images/playbutton2.png");return Util.preload_image("/static/images/preview_fail.png")};return{init:function(aB,aC){if(Lightbox.shown){return}ac();aC=aC||{};aq={include_delete:aC.include_delete||false,num_previews:aC.num_previews||null,header_selector:aC.header_selector,content_selector:aC.content_selector};at=aB;if(aC.start_index!==undefined){return Lightbox.show(aC.start_index)}else{return ax()}},resize_and_update_modal_position:function(){var aB;aB="translateY("+window.scrollY+"px)";if($j("#file-preview-modal").css("position")==="fixed"){aB=""}return A("#file-preview-modal").css({width:window.innerWidth,height:window.innerHeight,"-webkit-transform":aB,transform:aB,"-ms-transform":aB,"-moz-transform":aB,"-o-transform":aB})},show:function(aB){if(Lightbox.shown){return}F(at&&at.length,"Lightbox.show() requires file preview objects to show");au();if(aB!==undefined){aA=aB}history.replaceState({},"","#");history.pushState({lightbox:true},"","#");F(!Lightbox.shown,"Trying to reshow file preview modal");A("#file-preview-modal").show();Util.blackout_background(aq.header_selector,aq.content_selector);A(document.body).addClass("full-no-overflow");ap();return Lightbox.shown=1},set_no_wrap:function(aB){return aq.no_wrap=aB},PHOTO_CHANGE_EVT:"db:lightbox:photo_change",EXIT_SELECT_EVT:an,reload:false}})();window.SharingModel=LEGACY_JS.SharingModel={THUMBNAIL_WIDTH:79,THUMBNAIL_SELECTOR:"#gallery-media .photo-thumb",filename:null,is_folder:false,c2d_vars:{},link_url:null,preview_objs:[],is_my_link:false,init:function(aa,X,V,W,Z,Y){this.acting_uid=aa;this.display_name=X;this.c2d_vars=V;this.link_url=W;this.share_hint=Z;if(this.share_hint&&!Y){this._position_share_hint()}if(Y){this._show_c2d_menu()}this._remove_params();this._listen();this._touch_style();if(window.location.hash==="#share"){if($j("#share-menu").length>0){this._show_share_menu()}window.location.hash=""}return setInterval(Util.resize_inputs,1000)},init_file:function(){A("#download-menu-button").bind("click",A.proxy(this._show_download_menu,this));A("#c2d-menu .back-button").bind("click",A.proxy(this._show_download_menu,this));this.is_folder=false;this.is_album=false;if(!this.c2d_vars.subpath&&(this.c2d_vars.item_id==null)){return this.c2d_vars.subpath="/"+this.display_name}},init_folder:function(Y,V,X,W){this.gallery_showing=Y;this.preview_objs_info=V;this.is_album=X;this.show_lightbox=W;A("#download-menu-button").bind("click",A.proxy(this._show_c2d_menu,this));this.is_folder=true;if(this.is_album){DomUtil.fillVal(this.display_name,"album-unshare-name")}if(this.gallery_showing){Util.set_screen_width(A.proxy(this._set_gallery_view_width,this));return this._init_gallery(this.preview_objs_info,this.show_lightbox)}},_remove_params:function(){var W,V;V=S.get_uri();W=V.getQuery();delete W.m;return window.history.replaceState({},false,V.toString())},_listen:function(){var V;if(this.share_hint){A(window).bind("orientationchange resize",function(){return A("#share-hint").hide()})}A("#share-menu-button").bind("click",A.proxy(this._show_share_menu,this));A("#owner-menu-button").bind("click",A.proxy(this._show_owner_menu,this));A(".cancel-button").bind("click",A.proxy(this._return_to_content,this));if(A("#share-menu-button")){A("#share-menu #copy-link-menu-button").bind("click",A.proxy(this._show_copy_link_menu,this));A("#share-menu #fb-menu-button").bind("click",A.proxy(this._show_fb_menu,this));A("#share-menu #twitter-menu-button").bind("click",A.proxy(this._show_twitter_menu,this));A("#copy-link-menu .back-button").bind("click",A.proxy(this._show_share_menu,this));A("#fb-menu .back-button").bind("click",A.proxy(this._show_share_menu,this));A("#twitter-menu .back-button").bind("click",A.proxy(this._show_share_menu,this));A("#twitter-menu #twitter-post-submit").bind("click",A.proxy(this._do_twitter_post,this));A("#fb-menu #fb-post-submit").bind("click",A.proxy(this._do_fb_post,this));$j("#copy-link-menu #copy-link").on("click",function(){return H.ViralLogger.log(h.get_viewer().get_user_ids(),"shmodel","send",{src:"mwshmodel_copy_link",file_type:SharingModel.is_album?"collection":SharingModel.is_folder?"folder":SharingModel.display_name.indexOf(".")===-1?"file":BrowseFile.EXTENSION_TO_CATEGORY[s.file_extension(SharingModel.display_name).toLowerCase()]||"file"})});$j("#share-menu .bottom-option").on("click",function(){return H.ViralLogger.log(h.get_viewer().get_user_ids(),"shmodel","send",{src:"mwshmodel_share_email",file_type:SharingModel.is_album?"collection":SharingModel.is_folder?"folder":SharingModel.display_name.indexOf(".")===-1?"file":BrowseFile.EXTENSION_TO_CATEGORY[s.file_extension(SharingModel.display_name).toLowerCase()]||"file"})})}A("#owner-menu #remove-link").bind("click",A.proxy(this._show_remove_link_menu,this));A("#remove-link-menu .back-button").bind("click",A.proxy(this._show_owner_menu,this));V=function(W){W.preventDefault();return A("#remove-link-confirm-form").submit()};A("#remove-link-menu #remove-link-confirm").bind("click",V);A("#remove-link-menu #remove-link-cancel").bind("click",A.proxy(this._return_to_content,this));A("#download-menu .c2d-button.download-button").bind("click",(function(W){return function(X){return W._show_c2d_menu(X,A(X.target).data("uid"))}})(this));A("#download-menu .c2d-button.login-button").bind("click",(function(W){return function(X){return W._show_login_menu(X,true)}})(this));A("#c2d-menu .switch-account-link").bind("click",(function(W){return function(X){return W._show_login_menu(X,true)}})(this));A("#login-menu .back-button").bind("click",(function(W){return function(Y){var X;X=A("#login-menu .back-button").data("from-page");if(X==="c2d"){W._show_c2d_menu(Y)}else{W._show_download_menu(Y)}return A("#login-menu .back-button").removeData("from-page")}})(this));A("#register-menu .back-button").bind("click",A.proxy(this._show_c2d_menu,this));A("#c2d-menu #c2d-add-button").bind("click",A.proxy(this._do_c2d_wrapper,this));A("#c2d-menu #register-menu-button").bind("click",A.proxy(this._show_register_menu,this));A("#c2d-menu #login-menu-button").bind("click",A.proxy(this._show_login_menu,this));A("#register-menu #c2d-register-form").bind("submit",A.proxy(this._c2d_register,this));A("#login-menu #c2d-login-form").bind("submit",A.proxy(this._c2d_login,this));A("#twofactor-menu #c2d-twofactor-login-form").bind("submit",A.proxy(this._c2d_twofactor_login,this));A("#c2d-menu .switch-account-link").bind("click",(function(W){return function(X){return W._show_login_menu(X)}})(this));A("#share-menu .switch-account-link").bind("click",(function(W){return function(X){return W._show_share_login_menu(X)}})(this));return A("#share-login-menu .back-button").bind("click",(function(W){return function(X){return W._show_share_menu(X)}})(this))},_position_share_hint:function(){var X,W,V;V=A("#share-hint");X=A("#share-menu-button");W=X.offset().left-70;return V.css("left",W).show()},_touch_style:function(){var X,W,V;V="touch";X=function(Y){return A(this).addClass(V)};W=function(Y){return A(this).removeClass(V)};A(".menu a").bind("touchstart",X).bind("touchend",W);A("#default-content a.button-primary").bind("touchstart",X).bind("touchend",W);A("#shmodel-nav a.nav-button").bind("touchstart",X).bind("touchend",W);return A(".menu input[type=submit]").bind("touchstart",X).bind("touchend",W)},_set_gallery_view_width:function(){var V;V=Math.floor(Util.screen_width/this.THUMBNAIL_WIDTH)*this.THUMBNAIL_WIDTH;return A("#gallery-media").width(V)},_init_gallery:function(W,V){this._gallery_tmpl=P.tmpl("mobile_gallery_photo_thumb");this._render_gallery(W);if(V){this._gallery_listen();return this._init_lightbox(this.preview_objs_info)}},_init_lightbox:function(W){var Y,X,V;for(X=0,V=W.length;X<V;X++){Y=W[X];if(Y.is_video&&is_iphone()){this.preview_objs.push(new VideoPreview(Y.filename,Y.path,Y.thumbnail_url,Y.orig_url,C.parse(Y.orig_url).updateQuery({dl:"1"}).toString(),null,Y.shmodel_link,Y.preview_url))}else{this.preview_objs.push(new PhotoPreview(Y.filename,Y.path,Y.thumbnail_url,C.parse(Y.orig_url).updateQuery({dl:"1"}).toString(),Y.orig_url,null,Y.shmodel_link))}}return Lightbox.init(this.preview_objs,{include_delete:false,header_selector:"#shmodel-nav",content_selector:"#shmodel-folder-content"})},_render_gallery:function(Z){var X,W,Y,V;X=[];for(Y=0,V=Z.length;Y<V;Y++){W=Z[Y];X.push(this._gallery_tmpl({photo:W,thumbnail_url:W.gallery_thumb,file_path:W.shmodel_link,subject_uid:this.acting_uid}).toHTML())}A("#gallery-media").append(X);return Util.load_thumbs_in_view(this.THUMBNAIL_SELECTOR)},_gallery_listen:function(){var V;A("#gallery-media .photo-thumb").bind("click",A.proxy(this._thumb_click,this));A(window).bind("scroll",A.fn.curry(Util.load_thumbs_in_view,this,this.THUMBNAIL_SELECTOR));V=A.proxy(this._set_gallery_view_width,this);return A(window).bind("orientationchange",function(){return Util.set_screen_width(V)})},_thumb_click:function(W){var V,X;V=A(W.target).parents(".photo-thumb");X=A(".photo-thumb").index(V);return Lightbox.show(X)},_c2d_register:function(W){var V,X;if(W!=null){W.preventDefault()}V=A("#c2d-register-form");X=(function(Y){return function(aa,Z){set_csrf_token();return Y._do_c2d(Z.id)}})(this);return Forms.ajax_submit(V,"/ajax_register",X,false,"json")},_c2d_login:function(W){var V,X;if(W!=null){W.preventDefault()}V=A("#c2d-login-form");X=(function(Y){return function(aa,Z){switch(Z.status){case"OK":set_csrf_token();return Y._do_c2d(Z.id);case"TWOFACTOR":Y._show_twofactor_menu();if(Z.last_four_digits){DomUtil.fillVal(Z.last_four_digits,"last-four-digits");A("#c2d-twofactor-login-form").addClass("sms");return A("#twofactor-menu #c2d-resend-link").bind("click",A.proxy(Y._c2d_resend_phone_code,Y))}else{return A("#c2d-twofactor-login-form").removeClass("sms")}break;case"SSO":return window.location=Z.sso_url}}})(this);return Forms.ajax_submit(V,"/ajax_login",X,false,"json")},_c2d_resend_phone_code:function(V){if(V!=null){V.preventDefault()}if(this.c2d_is_resending()){return}this.c2d_show_resending();return A.ajax({url:"/twofactor_resend",type:"POST",success:(function(W){return function(X){switch(X){case"OK":return J.success(U("We sent you another code. It may take a few minutes to arrive."));case"UNREACHABLE":return W.c2d_show_twofactor_error_unreachable();case"EXPIRED":return J.error(U("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return W.c2d_show_twofactor_error_bad_carrier();case"INVALIDNUMBER":return W.c2d_show_twofactor_error_invalid_number();case"NOTAMOBILE":return W.c2d_show_twofactor_error_not_a_mobile()}}})(this),error:(function(W){return function(){return W.c2d_show_twofactor_error500()}})(this),complete:(function(W){return function(){return W.c2d_hide_resending()}})(this)})},_c2d_twofactor_login:function(X){var V,W,Y;X.preventDefault();if(!A("#c2d-twofactor-code").val()){this.c2d_show_twofactor_error_invalid();return}W=A("#c2d-twofactor-login-form");Y=(function(Z){return function(ab,aa){switch(aa.status){case"OK":set_csrf_token();return Z._do_c2d(aa.id);case"INVALID":return Z.c2d_show_twofactor_error_invalid();case"EXPIRED":return J.error(U("Sorry, your phone code has expired. Please log in again."))}}})(this);V=A.proxy(this.c2d_show_twofactor_error500,this);return Forms.ajax_submit(W,"/ajax_verify_code",Y,V,"json")},c2d_show_twofactor_error:function(W){var V;V=A("#c2d-twofactor-error");return V.text(W)},update_c2d_working_msg:(function(V){return function(X){var W,Y;if(!V.num_dots){V.num_dots=0}W=Array(V.num_dots+1).join(".");Y=U("Saving to your Dropbox...");J.success(Y+W);return V.num_dots=(V.num_dots+1)%5}})(this),_do_c2d_wrapper:function(){A("#c2d-form").hide();A("#c2d-working").show();this.update_c2d_working_msg();return this._do_c2d(Constants.uid)},_do_c2d:function(V){var X,W;W=function(Y){return window.location.href=Y};X=(function(Y){return function(Z){Y._return_to_content();return setTimeout((function(){return J.error(Z||U("Sorry, an error occurred. Please try again later."))}),400)}})(this);return A.ajax({url:C({path:"/sm/c2d"}),type:"POST",data:this.c2d_vars,subject_user:V,success:(function(Y){return function(aa){var Z;if(aa.indexOf("err:")===0){Z=aa.substr(4);X(Z);return}if(aa.indexOf("async_task_started:")===0){return Util.watch_async_task(V,aa.substr(19),W,Y.update_c2d_working_msg,X)}return W(aa)}})(this)})},_handle_embedded_response:function(Z,V){var W,X,Y;X=document.createElement("iframe");W={is_error:Z,body:V};Y="db-comms://"+encodeURIComponent(JSON.stringify(W));X.setAttribute("src",Y);X.setAttribute("height","1px");X.setAttribute("width","1px");document.documentElement.appendChild(X);X.parentNode.removeChild(X);return X=null},c2d_show_twofactor_error500:function(){return this.c2d_show_twofactor_error(U("Sorry, an error occured. Please try again later."))},c2d_show_twofactor_error_bad_carrier:function(){return this.c2d_show_twofactor_error(U("Unfortunately, your carrier is not supported at this time."))},c2d_show_twofactor_error_invalid_number:function(){return this.c2d_show_twofactor_error(U("That is not a valid phone number."))},c2d_show_twofactor_error_not_a_mobile:function(){return this.c2d_show_twofactor_error(U("That phone number does not appear to be a valid mobile number."))},c2d_show_twofactor_error_unreachable:function(){return this.c2d_show_twofactor_error(U("We couldn't reach your phone number. Are you sure it's correct?"))},c2d_show_twofactor_error_invalid:function(){return this.c2d_show_twofactor_error(U("Invalid code."))},c2d_is_resending:function(){return A("#c2d-resend-link").hasClass("resending")},c2d_show_resending:function(){return A("#c2d-resend-link").addClass("resending")},c2d_hide_resending:function(){return A("#c2d-resend-link").removeClass("resending")},_get_thumbnail_type:function(){var W,V;if(this.display_name.indexOf(".")===-1){return false}V=s.file_extension(this.display_name).toLowerCase();W=BrowseFile.EXTENSION_TO_CATEGORY[V];if(W&&(W==="IMAGE"||W==="VIDEO")){return BrowseFile.CATEGORY_TO_TRANSLATION[W]}return false},_hide_behind:function(){A("#shmodel-nav").hide();A("#shmodel-content-area").hide();return A(".menu").hide()},_return_to_content:function(V){if(V!=null){V.preventDefault()}A("#login-menu .back-button").removeData("back-page");A(".menu").hide();A("#shmodel-nav").show();return A("#shmodel-content-area").show()},_show_share_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();if(this.share_hint){A("#share-hint").hide()}return A("#share-menu").show()},_show_copy_link_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();return A("#copy-link-menu").show()},_show_fb_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();return A("#fb-menu").show().find("#fb-post-input").focus()},_show_twitter_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();this._populate_twitter_input();return A("#twitter-menu").show().find("#twitter-post-input").focus()},_show_owner_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();return A("#owner-menu").show()},_show_remove_link_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();return A("#remove-link-menu").show()},_show_download_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();return A("#download-menu").show()},_show_c2d_menu:function(V){if(V!=null){V.preventDefault()}A("#login-menu .back-button").data("from-page","c2d");this._hide_behind();return A("#c2d-menu").show()},_show_register_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();return A("#register-menu").show().find("#fname").focus()},_show_login_menu:function(W,X){var V;if(X==null){X=false}if(W!=null){W.preventDefault()}this._hide_behind();V=A("#login-menu").show();if(X){return V.find("#login-password").focus()}else{return V.find("#login-email").focus()}},_show_share_login_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();return A("#share-login-menu").show().find("#login-password").focus()},_show_twofactor_menu:function(V){if(V!=null){V.preventDefault()}this._hide_behind();return A("#twofactor-menu").show().find("#c2d-twofactor-code").focus()},_do_fb_post:function(V){var W;if(V!=null){V.preventDefault()}W=A("#fb-post-input").val();if(!W){J.error(U("Please enter a Facebook post"));return}if(FacebookOAuth.authed_user_id==null){FacebookOAuth.redirect_to_post(SharingModel.link_url);return}return FacebookOAuth.post(W,SharingModel.link_url,(function(X){return function(){X._return_to_content();J.success(U("Successfully posted to Facebook"));return H.ViralLogger.log(h.get_viewer().get_user_ids(),"shmodel","send",{src:"mwshmodel_fb_post",file_type:SharingModel.is_album?"collection":SharingModel.is_folder?"folder":SharingModel.display_name.indexOf(".")===-1?"file":BrowseFile.EXTENSION_TO_CATEGORY[s.file_extension(SharingModel.display_name).toLowerCase()]||"file"})}})(this))},_do_twitter_post:function(V){var W;if(V!=null){V.preventDefault()}W=A("#twitter-post-input").val();if(!W){J.error(U("Please enter a Twitter post"));return}else{if(W.length>140){J.error(U("Your post must be 140 characters or less"));return}}if(!Twitter.has_authed){Twitter.redirect_to_post(W);return}return Twitter.custom_post(W,(function(X){return function(){X._return_to_content();J.success(U("Successfully posted to Twitter"));return H.ViralLogger.log(h.get_viewer().get_user_ids(),"shmodel","send",{src:"mwshmodel_twitter",file_type:SharingModel.is_album?"collection":SharingModel.is_folder?"folder":SharingModel.display_name.indexOf(".")===-1?"file":BrowseFile.EXTENSION_TO_CATEGORY[s.file_extension(SharingModel.display_name).toLowerCase()]||"file"})}})(this),Constants.uid)},_populate_twitter_input:function(){var W,V;if(SharingModel.is_folder){W=U("Just shared some files using @Dropbox")}else{V=SharingModel._get_thumbnail_type();if(V&&V===BrowseFile.CATEGORY_TO_TRANSLATION.IMAGE){W=U("Just shared an image using @Dropbox")}else{W=U("Just shared a file using @Dropbox")}}A("#twitter-menu #twitter-post-input").val(W+" "+SharingModel.link_url);return Util.track_twitter_chars_left("twitter-post-input",140)}};window.ShmodelPreview=LEGACY_JS.ShmodelPreview={init_photo:function(Y,W){var V,X;V=A("#preview-box #preview-img").attr("src",Y)[0];setInterval(A.fn.curry(this._resize_preview_img,this,Y),500);X=function(){return window.location.href=Y};TouchUtil.doubletap(V,X);return TouchUtil.gesturestart(V,X)},_resize_preview_img:function(Y){var Z,V,W,X;W=A("#preview-box #preview-img");if(W.attr("src")===Y){Z=Util.get_preview_img_dimensions(W[0]);X=Z?Z.width:"";V=Z?Z.height:"";return A(W).width(X).height(V).show()}}};window.Twitter=LEGACY_JS.Twitter={redirect_to_post:function(V){return window.open("http://www.twitter.com/home?status="+encodeURI(V))},custom_post:function(W,V){if(V){this.onPostSuccessCallback=V}if(!W){return}F(W,"Twitter message doesn't exist");return this.post(W)},post:function(Y){var W,X,V;F(Y,"Twitter message is empty");W=A("#twitter-post-form");X=(function(Z){return function(aa){if(aa.responseText==="login"){Z.redirect_to_post(Y)}else{if(Z.onPostSuccessCallback){return Z.onPostSuccessCallback()}}}})(this);V=C({path:"/twitter_post"}).updateQuery(Constants.UID_PARAM_NAME,Constants.uid);return Forms.ajax_submit(W,V.toString(),X,Constants.uid)}};window.FacebookOAuth=LEGACY_JS.FacebookOAuth={redirect_to_post:function(V){return window.open("http://www.facebook.com/sharer.php?u="+encodeURI(V))},post:function(Z,W,Y){var X,V;if(Y){this.onPostSuccessCallback=Y}F(Z,"Facebook post is empty");F(W,"Link is missing");X=A("#fb-post-form");Y=(function(aa){return function(ab){if(ab.responseText!=="ok"){aa.redirect_to_post(W);return}if(aa.onPostSuccessCallback){return aa.onPostSuccessCallback()}}})(this);V={link:W};return Forms.ajax_submit(X,"/fb/post",Y,false,false,V)}};window.viewer=h.get_viewer();var z,O,n,I;if(window._jquery_ready_handlers){I=window._jquery_ready_handlers;for(O=0,n=I.length;O<n;O++){z=I[O];jQuery(z)}}return LEGACY_JS});